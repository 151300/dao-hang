# GitHub È°πÁõÆÁªìÊûÑ

```
dao-hang/
‚îú‚îÄ‚îÄ README.md                          # È°πÁõÆËØ¥ÊòéÊñáÊ°£
‚îú‚îÄ‚îÄ package.json                       # npmÂåÖÈÖçÁΩÆ
‚îú‚îÄ‚îÄ wrangler.toml                      # Cloudflare WorkersÈÖçÁΩÆ
‚îú‚îÄ‚îÄ .env.example                       # ÁéØÂ¢ÉÂèòÈáèÁ§∫‰æã
‚îú‚îÄ‚îÄ .gitignore                         # GitÂøΩÁï•Êñá‰ª∂
‚îú‚îÄ‚îÄ public/                            # ÈùôÊÄÅËµÑÊ∫ê
‚îÇ   ‚îú‚îÄ‚îÄ favicon.ico                    # ÁΩëÁ´ôÂõæÊ†á
‚îÇ   ‚îú‚îÄ‚îÄ default-bg.jpg                 # ÈªòËÆ§ËÉåÊôØÂõæÁâá
‚îÇ   ‚îî‚îÄ‚îÄ uploads/                       # ‰∏ä‰º†Êñá‰ª∂ÁõÆÂΩï
‚îÇ       ‚îî‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ src/                               # Ê∫ê‰ª£Á†ÅÁõÆÂΩï
‚îÇ   ‚îú‚îÄ‚îÄ index.js                       # Workers‰∏ªÂÖ•Âè£Êñá‰ª∂
‚îÇ   ‚îú‚îÄ‚îÄ auth.js                        # ËÆ§ËØÅÊ®°Âùó
‚îÇ   ‚îú‚îÄ‚îÄ storage.js                     # Â≠òÂÇ®Êìç‰ΩúÊ®°Âùó
‚îÇ   ‚îú‚îÄ‚îÄ templates.js                   # HTMLÊ®°Êùø
‚îÇ   ‚îú‚îÄ‚îÄ utils.js                       # Â∑•ÂÖ∑ÂáΩÊï∞
‚îÇ   ‚îî‚îÄ‚îÄ config.js                      # ÈÖçÁΩÆÊñá‰ª∂
‚îú‚îÄ‚îÄ docs/                              # ÊñáÊ°£
‚îÇ   ‚îú‚îÄ‚îÄ deployment.md                  # ÈÉ®ÁΩ≤ÊåáÂçó
‚îÇ   ‚îú‚îÄ‚îÄ api-reference.md               # APIÂèÇËÄÉ
‚îÇ   ‚îú‚îÄ‚îÄ version-plan.md                # ÁâàÊú¨ËÆ°Âàí
‚îÇ   ‚îî‚îÄ‚îÄ screenshots/                   # Êà™ÂõæÁõÆÂΩï
‚îú‚îÄ‚îÄ tests/                             # ÊµãËØïÊñá‰ª∂
‚îÇ   ‚îú‚îÄ‚îÄ test-auth.js                   # ËÆ§ËØÅÊµãËØï
‚îÇ   ‚îú‚îÄ‚îÄ test-storage.js                # Â≠òÂÇ®ÊµãËØï
‚îÇ   ‚îî‚îÄ‚îÄ test-handlers.js               # Â§ÑÁêÜÂô®ÊµãËØï
‚îú‚îÄ‚îÄ scripts/                           # ËÑöÊú¨Êñá‰ª∂
‚îÇ   ‚îú‚îÄ‚îÄ deploy.sh                      # ÈÉ®ÁΩ≤ËÑöÊú¨
‚îÇ   ‚îú‚îÄ‚îÄ backup-data.js                 # Êï∞ÊçÆÂ§á‰ªΩËÑöÊú¨
‚îÇ   ‚îî‚îÄ‚îÄ import-export.js               # Êï∞ÊçÆÂØºÂÖ•ÂØºÂá∫ËÑöÊú¨
‚îî‚îÄ‚îÄ examples/                          # Á§∫‰æãÊñá‰ª∂
    ‚îú‚îÄ‚îÄ custom-theme.css               # Ëá™ÂÆö‰πâ‰∏ªÈ¢òÁ§∫‰æã
    ‚îú‚îÄ‚îÄ sample-data.json               # Á§∫‰æãÊï∞ÊçÆ
    ‚îî‚îÄ‚îÄ r2-integration.js              # R2ÈõÜÊàêÁ§∫‰æã
```

---

## 1. `README.md` - È°πÁõÆËØ¥ÊòéÊñáÊ°£

```markdown
# Dao-Hang ÂØºËà™Á≥ªÁªü üöÄ

‰∏Ä‰∏™Âü∫‰∫é Cloudflare Workers ÁöÑÂÖçË¥π„ÄÅÂèØËá™ÂÆö‰πâÁöÑÂØºËà™ÁΩëÁ´ôÁ≥ªÁªü„ÄÇ

## ‚ú® ÁâπÊÄß

- üÜì **ÂÆåÂÖ®ÂÖçË¥π**Ôºö‰ΩøÁî® Cloudflare ÂÖçË¥πÊúçÂä°
- üîê **ÂÆâÂÖ®ÁôªÂΩï**ÔºöË¥¶Âè∑ÂØÜÁ†ÅÁÆ°ÁêÜ
- üé® **È´òÂ∫¶ÂèØÂÆöÂà∂**ÔºöËá™ÂÆö‰πâÂàÜÁ±ª„ÄÅËÉåÊôØ„ÄÅ‰∏ªÈ¢ò
- üì± **ÂìçÂ∫îÂºèËÆæËÆ°**ÔºöÈÄÇÈÖçÊâÄÊúâËÆæÂ§á
- üíæ **Êï∞ÊçÆÊåÅ‰πÖÂåñ**Ôºö‰ΩøÁî® Cloudflare KV Â≠òÂÇ®
- ‚ö° **Âø´ÈÄüÂä†ËΩΩ**ÔºöËæπÁºòËÆ°ÁÆóÔºåÂÖ®ÁêÉÂä†ÈÄü
- üîÑ **ÂÆûÊó∂ÁºñËæë**Ôºö‰øÆÊîπÂç≥Êó∂ÁîüÊïà

## üöÄ Âø´ÈÄüÂºÄÂßã

### 1. ÂÖãÈöÜÈ°πÁõÆ
```bash
git clone https://github.com/yourusername/dao-hang.git
cd dao-hang
```

### 2. ÂÆâË£Ö‰æùËµñ
```bash
npm install
```

### 3. ÈÖçÁΩÆÁéØÂ¢É
```bash
cp .env.example .env
# ÁºñËæë .env Êñá‰ª∂ÔºåËÆæÁΩÆ‰Ω†ÁöÑÈÖçÁΩÆ
```

### 4. ÈÉ®ÁΩ≤
```bash
npm run deploy
```

## üìã ÂäüËÉΩÂàóË°®

### ÁâàÊú¨‰∏ÄÔºàÂΩìÂâçÔºâ
- [x] Âü∫Á°ÄÂØºËà™ÂäüËÉΩ
- [x] 3-5‰∏™ÂàÜÁ±ªÁÆ°ÁêÜ
- [x] Âú®Á∫øÁºñËæë
- [x] Ë¥¶Âè∑ÂØÜÁ†ÅÁôªÂΩï
- [x] ËÉåÊôØÂõæÁâáËÆæÁΩÆ
- [x] ÂàÜÁ±ªÂ±ïÂºÄ/ÈöêËóè

### ÁâàÊú¨‰∫åÔºàÂºÄÂèë‰∏≠Ôºâ
- [ ] Êõ¥Â§öÁΩëÁ´ôÊîØÊåÅ
- [ ] ÂÆûÊó∂ÁºñËæë
- [ ] ËÉåÊôØÈü≥‰πê
- [ ] ‰∏ªÈ¢òÂàáÊç¢
- [ ] Êï∞ÊçÆÂØºÂÖ•ÂØºÂá∫

### ÁâàÊú¨‰∏âÔºàËßÑÂàí‰∏≠Ôºâ
- [ ] Áî®Êà∑Ê≥®ÂÜåÁ≥ªÁªü
- [ ] ÁΩëÁ´ôÂõæÊ†áËá™Âä®Ëé∑Âèñ
- [ ] ‰ΩøÁî®ÈáèÁªüËÆ°
- [ ] ÁßªÂä®Á´ØÂ∫îÁî®
- [ ] APIÊé•Âè£

## üîß ÈÖçÁΩÆËØ¥Êòé

### ÁéØÂ¢ÉÂèòÈáè
```env
ADMIN_USERNAME=admin        # ÁÆ°ÁêÜÂëòÁî®Êà∑Âêç
ADMIN_PASSWORD=changeme     # ÁÆ°ÁêÜÂëòÂØÜÁ†Å
SITE_NAME=ÊàëÁöÑÂØºËà™         # ÁΩëÁ´ôÂêçÁß∞
KV_NAMESPACE_ID=           # Cloudflare KVÂëΩÂêçÁ©∫Èó¥ID
```

### Êñá‰ª∂ÁªìÊûÑ
- `public/` - ÈùôÊÄÅËµÑÊ∫êÊñá‰ª∂
- `src/` - Ê∫ê‰ª£Á†Å
- `docs/` - ÊñáÊ°£
- `tests/` - ÊµãËØïÊñá‰ª∂
- `scripts/` - ÈÉ®ÁΩ≤ËÑöÊú¨

## üõ†Ô∏è ÂºÄÂèë

```bash
# ÂºÄÂèëÊ®°Âºè
npm run dev

# ÊµãËØï
npm run test

# ÊûÑÂª∫
npm run build

# ÈÉ®ÁΩ≤Âà∞Áîü‰∫ßÁéØÂ¢É
npm run deploy

# ÈÉ®ÁΩ≤Âà∞È¢ÑËßàÁéØÂ¢É
npm run deploy:preview
```

## üìö ËØ¶ÁªÜÊñáÊ°£

- [ÈÉ®ÁΩ≤ÊåáÂçó](./docs/deployment.md)
- [APIÂèÇËÄÉ](./docs/api-reference.md)
- [ÁâàÊú¨ËÆ°Âàí](./docs/version-plan.md)

## ü§ù Ë¥°ÁåÆ

Ê¨¢ËøéÊèê‰∫§ Issue Âíå Pull RequestÔºÅ

## üìÑ ËÆ∏ÂèØËØÅ

MIT License

## üôè Ëá¥Ë∞¢

- [Cloudflare Workers](https://workers.cloudflare.com/)
- [Wrangler CLI](https://developers.cloudflare.com/workers/wrangler/)
- ÊâÄÊúâË¥°ÁåÆËÄÖ

## üîó Áõ∏ÂÖ≥ÈìæÊé•

- [Âú®Á∫øÊºîÁ§∫](https://dao-hang.yourusername.workers.dev)
- [ÈóÆÈ¢òÂèçÈ¶à](https://github.com/yourusername/dao-hang/issues)
- [Êõ¥Êñ∞Êó•Âøó](./CHANGELOG.md)
```

---

## 2. `package.json` - npmÂåÖÈÖçÁΩÆ

```json
{
  "name": "dao-hang",
  "version": "1.0.0",
  "description": "A free navigation website built on Cloudflare Workers",
  "main": "src/index.js",
  "scripts": {
    "dev": "wrangler dev",
    "deploy": "wrangler deploy",
    "deploy:preview": "wrangler deploy --env preview",
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "lint": "eslint src/",
    "lint:fix": "eslint src/ --fix",
    "format": "prettier --write \"src/**/*.js\"",
    "backup": "node scripts/backup-data.js",
    "import": "node scripts/import-export.js --import",
    "export": "node scripts/import-export.js --export"
  },
  "keywords": [
    "cloudflare",
    "workers",
    "navigation",
    "bookmarks",
    "free"
  ],
  "author": "Your Name",
  "license": "MIT",
  "devDependencies": {
    "jest": "^29.7.0",
    "eslint": "^8.56.0",
    "eslint-config-prettier": "^9.1.0",
    "eslint-plugin-prettier": "^5.1.3",
    "prettier": "^3.2.5",
    "wrangler": "^3.0.0"
  },
  "dependencies": {},
  "engines": {
    "node": ">=16.0.0"
  },
  "repository": {
    "type": "git",
    "url": "git+https://github.com/yourusername/dao-hang.git"
  },
  "bugs": {
    "url": "https://github.com/yourusername/dao-hang/issues"
  },
  "homepage": "https://github.com/yourusername/dao-hang#readme"
}
```

---

## 3. `wrangler.toml` - Cloudflare WorkersÈÖçÁΩÆ

```toml
name = "dao-hang"
main = "src/index.js"
compatibility_date = "2024-08-01"
compatibility_flags = ["nodejs_compat"]

# KV ÂëΩÂêçÁ©∫Èó¥Â≠òÂÇ®
kv_namespaces = [
  { binding = "NAV_STORE", id = "your-kv-namespace-id", preview_id = "preview-kv-id" }
]

# R2 Â≠òÂÇ®ÔºàÁî®‰∫éÊñá‰ª∂‰∏ä‰º†ÔºåÂèØÈÄâÔºâ
[[r2_buckets]]
binding = "UPLOAD_BUCKET"
bucket_name = "dao-hang-uploads"
preview_bucket_name = "dao-hang-uploads-preview"

# ÁéØÂ¢ÉÂèòÈáè
[vars]
ADMIN_USERNAME = "admin"
SITE_NAME = "ÊàëÁöÑÂØºËà™"
VERSION = "1.0.0"

# ÂºÄÂèëÁéØÂ¢ÉÈÖçÁΩÆ
[env.dev]
vars = { ADMIN_PASSWORD = "dev_password", ENVIRONMENT = "development" }

# È¢ÑËßàÁéØÂ¢ÉÈÖçÁΩÆ
[env.preview]
vars = { ADMIN_PASSWORD = "preview_password", ENVIRONMENT = "preview" }

# Áîü‰∫ßÁéØÂ¢ÉÈÖçÁΩÆ
[env.production]
vars = { ADMIN_PASSWORD = "${ADMIN_PASSWORD}", ENVIRONMENT = "production" }

# Ë∑ØÁî±ÈÖçÁΩÆÔºàÁîü‰∫ßÁéØÂ¢ÉÔºâ
[env.production.route]
pattern = "dao-hang.yourdomain.com/*"
zone_id = "your-zone-id"

# È¢ÑËßàÁéØÂ¢ÉË∑ØÁî±
[env.preview.route]
pattern = "dao-hang-preview.yourdomain.com/*"
zone_id = "your-zone-id"
```

---

## 4. `.env.example` - ÁéØÂ¢ÉÂèòÈáèÁ§∫‰æã

```env
# Cloudflare Ë¥¶Êà∑ÈÖçÁΩÆ
CLOUDFLARE_ACCOUNT_ID=your_account_id
CLOUDFLARE_API_TOKEN=your_api_token

# ÁÆ°ÁêÜÂëòËÆ§ËØÅ
ADMIN_USERNAME=admin
ADMIN_PASSWORD=your_secure_password_here

# KV ÂëΩÂêçÁ©∫Èó¥
KV_NAMESPACE_ID=your_kv_namespace_id
KV_PREVIEW_NAMESPACE_ID=your_preview_kv_id

# ÁΩëÁ´ôÈÖçÁΩÆ
SITE_NAME=ÊàëÁöÑÂØºËà™
SITE_DESCRIPTION=Á≤æÂøÉÊï¥ÁêÜÁöÑÂÆûÁî®ÁΩëÁ´ôÂØºËà™
SITE_KEYWORDS=ÂØºËà™,‰π¶Á≠æ,Â∑•ÂÖ∑,ÁΩëÁ´ô

# Ëá™ÂÆö‰πâÂüüÂêç
DOMAIN=dao-hang.yourdomain.com
PREVIEW_DOMAIN=dao-hang-preview.yourdomain.com

# ÂÆâÂÖ®ÈÖçÁΩÆ
SESSION_TIMEOUT=86400
MAX_UPLOAD_SIZE=5242880
ALLOWED_FILE_TYPES=jpg,jpeg,png,gif,webp

# ÂäüËÉΩÂºÄÂÖ≥
ENABLE_BACKGROUND_MUSIC=false
ENABLE_USER_REGISTRATION=false
ENABLE_ANALYTICS=false

# Ë∞ÉËØïÊ®°Âºè
DEBUG=true
NODE_ENV=development
```

---

## 5. `.gitignore` - GitÂøΩÁï•Êñá‰ª∂

```gitignore
# ‰æùËµñ
node_modules/
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*

# ÁéØÂ¢ÉÂèòÈáè
.env
.env.local
.env.development.local
.env.test.local
.env.production.local

# ÊûÑÂª∫ËæìÂá∫
dist/
build/
.wrangler/

# Êìç‰ΩúÁ≥ªÁªüÊñá‰ª∂
.DS_Store
Thumbs.db

# ÁºñËæëÂô®Êñá‰ª∂
.vscode/
.idea/
*.swp
*.swo

# ÊµãËØïË¶ÜÁõñÁéá
coverage/
.nyc_output/

# Êó•ÂøóÊñá‰ª∂
logs/
*.log

# ‰∏ä‰º†Êñá‰ª∂
public/uploads/*
!public/uploads/README.md

# Â§á‰ªΩÊñá‰ª∂
*.bak
*.backup

# ‰∏¥Êó∂Êñá‰ª∂
tmp/
temp/
```

---

## 6. `src/index.js` - Workers‰∏ªÂÖ•Âè£Êñá‰ª∂

```javascript
/**
 * Dao-Hang ÂØºËà™Á≥ªÁªü‰∏ªÂÖ•Âè£
 * ÁâàÊú¨: 1.0.0
 */

import { handleHome } from './handlers/home.js';
import { handleLogin } from './handlers/auth.js';
import { handleAdmin } from './handlers/admin.js';
import { handleApi } from './handlers/api.js';
import { verifySession } from './auth.js';
import { errorResponse } from './utils.js';

export default {
  async fetch(request, env, ctx) {
    try {
      const url = new URL(request.url);
      const path = url.pathname;
      
      console.log(`[${new Date().toISOString()}] ${request.method} ${path}`);
      
      // Â§ÑÁêÜÈùôÊÄÅÊñá‰ª∂
      if (path.startsWith('/public/')) {
        return handleStatic(request, env);
      }
      
      // Ë∑ØÁî±ÂàÜÂèë
      switch (true) {
        case path === '/':
          return handleHome(request, env);
          
        case path === '/login':
          return handleLogin(request, env);
          
        case path === '/logout':
          return handleLogout(request, env);
          
        case path === '/admin':
          const isAdmin = await verifySession(request, env);
          if (!isAdmin) {
            return Response.redirect(new URL('/login', request.url), 302);
          }
          return handleAdmin(request, env);
          
        case path.startsWith('/api/'):
          return handleApi(request, env);
          
        default:
          return new Response('404 - Page Not Found', {
            status: 404,
            headers: { 'Content-Type': 'text/html; charset=UTF-8' }
          });
      }
    } catch (error) {
      console.error('Error handling request:', error);
      return errorResponse('Internal Server Error', 500);
    }
  }
};

/**
 * Â§ÑÁêÜÈùôÊÄÅÊñá‰ª∂ËØ∑Ê±Ç
 */
async function handleStatic(request, env) {
  const url = new URL(request.url);
  const path = url.pathname.replace('/public/', '');
  
  // ÂÆâÂÖ®È™åËØÅÔºöÈò≤Ê≠¢Ë∑ØÂæÑÈÅçÂéÜ
  if (path.includes('..') || path.includes('//')) {
    return new Response('Forbidden', { status: 403 });
  }
  
  // ‰ªé R2 Êàñ KV Ëé∑ÂèñÈùôÊÄÅÊñá‰ª∂
  try {
    if (env.UPLOAD_BUCKET) {
      const object = await env.UPLOAD_BUCKET.get(path);
      if (object) {
        const headers = new Headers();
        object.writeHttpMetadata(headers);
        headers.set('etag', object.httpEtag);
        
        return new Response(object.body, {
          headers,
        });
      }
    }
    
    return new Response('File not found', { status: 404 });
  } catch (error) {
    console.error('Error serving static file:', error);
    return new Response('Error serving file', { status: 500 });
  }
}

/**
 * Â§ÑÁêÜÁôªÂá∫
 */
async function handleLogout(request, env) {
  const cookieHeader = request.headers.get('Cookie');
  if (cookieHeader) {
    const cookies = Object.fromEntries(
      cookieHeader.split(';').map(c => c.trim().split('='))
    );
    const sessionToken = cookies.session;
    if (sessionToken) {
      await env.NAV_STORE.delete(`session_${sessionToken}`);
    }
  }
  
  return new Response(null, {
    status: 302,
    headers: {
      'Location': '/',
      'Set-Cookie': 'session=; HttpOnly; Path=/; Max-Age=0; SameSite=Lax'
    }
  });
}
```

---

## 7. `src/auth.js` - ËÆ§ËØÅÊ®°Âùó

```javascript
/**
 * Áî®Êà∑ËÆ§ËØÅÊ®°Âùó
 */

import { hashPassword, verifyPassword } from './utils.js';

/**
 * Â§ÑÁêÜÁî®Êà∑ÁôªÂΩï
 */
export async function handleLogin(request, env) {
  if (request.method === 'POST') {
    try {
      const formData = await request.formData();
      const username = formData.get('username');
      const password = formData.get('password');
      
      // È™åËØÅÂá≠ÊçÆ
      if (username === env.ADMIN_USERNAME && password === env.ADMIN_PASSWORD) {
        // ÂàõÂª∫‰ºöËØù
        const sessionToken = crypto.randomUUID();
        const sessionExpiry = Math.floor(Date.now() / 1000) + (env.SESSION_TIMEOUT || 86400);
        
        await env.NAV_STORE.put(
          `session_${sessionToken}`,
          JSON.stringify({
            username,
            expires: sessionExpiry
          }),
          { expirationTtl: env.SESSION_TIMEOUT || 86400 }
        );
        
        // ÈáçÂÆöÂêëÂà∞ÁÆ°ÁêÜÂêéÂè∞
        return new Response(null, {
          status: 302,
          headers: {
            'Location': '/admin',
            'Set-Cookie': `session=${sessionToken}; HttpOnly; Path=/; Max-Age=86400; SameSite=Lax${
              env.ENVIRONMENT === 'production' ? '; Secure' : ''
            }`
          }
        });
      } else {
        return loginPage('Áî®Êà∑ÂêçÊàñÂØÜÁ†ÅÈîôËØØ');
      }
    } catch (error) {
      console.error('Login error:', error);
      return loginPage('ÁôªÂΩïÊó∂ÂèëÁîüÈîôËØØ');
    }
  }
  
  return loginPage();
}

/**
 * È™åËØÅ‰ºöËØù
 */
export async function verifySession(request, env) {
  try {
    const cookieHeader = request.headers.get('Cookie');
    if (!cookieHeader) return false;
    
    const cookies = Object.fromEntries(
      cookieHeader.split(';').map(c => c.trim().split('='))
    );
    
    const sessionToken = cookies.session;
    if (!sessionToken) return false;
    
    // ‰ªé KV Ëé∑Âèñ‰ºöËØù
    const sessionData = await env.NAV_STORE.get(`session_${sessionToken}`);
    if (!sessionData) return false;
    
    const session = JSON.parse(sessionData);
    
    // Ê£ÄÊü•‰ºöËØùÊòØÂê¶ËøáÊúü
    if (session.expires < Math.floor(Date.now() / 1000)) {
      await env.NAV_STORE.delete(`session_${sessionToken}`);
      return false;
    }
    
    return true;
  } catch (error) {
    console.error('Session verification error:', error);
    return false;
  }
}

/**
 * ÁôªÂΩïÈ°µÈù¢ HTML
 */
function loginPage(errorMessage = '') {
  const html = `
    <!DOCTYPE html>
    <html lang="zh-CN">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>ÁôªÂΩï - Dao-Hang ÂØºËà™Á≥ªÁªü</title>
      <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          min-height: 100vh;
          display: flex;
          justify-content: center;
          align-items: center;
          padding: 20px;
        }
        .login-container {
          width: 100%;
          max-width: 400px;
          background: white;
          border-radius: 16px;
          box-shadow: 0 20px 60px rgba(0,0,0,0.15);
          overflow: hidden;
        }
        .login-header {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          padding: 40px 30px;
          text-align: center;
        }
        .login-header h1 {
          font-size: 24px;
          font-weight: 600;
          margin-bottom: 8px;
        }
        .login-header p {
          opacity: 0.9;
          font-size: 14px;
        }
        .login-form {
          padding: 40px 30px;
        }
        .form-group {
          margin-bottom: 24px;
        }
        .form-group label {
          display: block;
          margin-bottom: 8px;
          color: #4a5568;
          font-size: 14px;
          font-weight: 500;
        }
        .form-group input {
          width: 100%;
          padding: 14px 16px;
          border: 2px solid #e2e8f0;
          border-radius: 8px;
          font-size: 16px;
          transition: border-color 0.2s;
        }
        .form-group input:focus {
          outline: none;
          border-color: #667eea;
        }
        .error-message {
          background: #fed7d7;
          color: #9b2c2c;
          padding: 12px 16px;
          border-radius: 8px;
          margin-bottom: 20px;
          font-size: 14px;
          border-left: 4px solid #fc8181;
        }
        .login-button {
          width: 100%;
          padding: 16px;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          border: none;
          border-radius: 8px;
          font-size: 16px;
          font-weight: 600;
          cursor: pointer;
          transition: transform 0.2s, box-shadow 0.2s;
        }
        .login-button:hover {
          transform: translateY(-2px);
          box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }
        .login-footer {
          text-align: center;
          margin-top: 24px;
          color: #718096;
          font-size: 14px;
        }
        .login-footer a {
          color: #667eea;
          text-decoration: none;
        }
        @media (max-width: 480px) {
          .login-container {
            border-radius: 12px;
          }
          .login-header, .login-form {
            padding: 30px 20px;
          }
        }
      </style>
    </head>
    <body>
      <div class="login-container">
        <div class="login-header">
          <h1>Dao-Hang ÂØºËà™Á≥ªÁªü</h1>
          <p>ËØ∑ÁôªÂΩïÁÆ°ÁêÜÂêéÂè∞</p>
        </div>
        <form method="POST" class="login-form">
          ${errorMessage ? `<div class="error-message">${errorMessage}</div>` : ''}
          <div class="form-group">
            <label for="username">Áî®Êà∑Âêç</label>
            <input type="text" id="username" name="username" required autofocus>
          </div>
          <div class="form-group">
            <label for="password">ÂØÜÁ†Å</label>
            <input type="password" id="password" name="password" required>
          </div>
          <button type="submit" class="login-button">ÁôªÂΩï</button>
        </form>
        <div class="login-footer">
          <p>ËøîÂõû <a href="/">È¶ñÈ°µ</a></p>
        </div>
      </div>
    </body>
    </html>
  `;
  
  return new Response(html, {
    headers: {
      'Content-Type': 'text/html; charset=UTF-8',
      'Cache-Control': 'no-cache, no-store, must-revalidate'
    }
  });
}
```

---

## 8. `src/storage.js` - Â≠òÂÇ®Êìç‰ΩúÊ®°Âùó

```javascript
/**
 * Êï∞ÊçÆÂ≠òÂÇ®Êìç‰ΩúÊ®°Âùó
 * ‰ΩøÁî® Cloudflare KV Â≠òÂÇ®ÂØºËà™Êï∞ÊçÆ
 */

/**
 * Âä†ËΩΩÂØºËà™Êï∞ÊçÆ
 */
export async function loadNavData(env) {
  try {
    const data = await env.NAV_STORE.get('nav_data');
    
    if (!data) {
      return getDefaultData(env);
    }
    
    const navData = JSON.parse(data);
    
    // ËøÅÁßªÊóßÊï∞ÊçÆÊ†ºÂºèÔºàÂ¶ÇÊûúÊúâÁöÑËØùÔºâ
    return migrateData(navData);
  } catch (error) {
    console.error('Error loading nav data:', error);
    return getDefaultData(env);
  }
}

/**
 * ‰øùÂ≠òÂØºËà™Êï∞ÊçÆ
 */
export async function saveNavData(env, data) {
  try {
    // Ê∑ªÂä†Êõ¥Êñ∞Êó∂Èó¥
    data.updatedAt = new Date().toISOString();
    data.version = env.VERSION || '1.0.0';
    
    await env.NAV_STORE.put('nav_data', JSON.stringify(data));
    return { success: true, updatedAt: data.updatedAt };
  } catch (error) {
    console.error('Error saving nav data:', error);
    return { success: false, error: error.message };
  }
}

/**
 * Ëé∑ÂèñÈªòËÆ§Êï∞ÊçÆ
 */
function getDefaultData(env) {
  const siteName = env.SITE_NAME || 'ÊàëÁöÑÂØºËà™';
  const description = env.SITE_DESCRIPTION || 'Á≤æÂøÉÊï¥ÁêÜÁöÑÂÆûÁî®ÁΩëÁ´ôÂØºËà™';
  
  return {
    siteName,
    description,
    config: {
      bgColor: '#f8fafc',
      bgImage: '',
      theme: 'light',
      showCategories: true,
      showSearch: true,
      layout: 'grid',
      itemsPerRow: 4
    },
    categories: [
      {
        id: 1,
        name: 'Â∏∏Áî®Â∑•ÂÖ∑',
        description: 'Êó•Â∏∏‰ΩøÁî®ÁöÑÂ∑•ÂÖ∑ÁΩëÁ´ô',
        icon: 'üîß',
        hidden: false,
        order: 1,
        sites: [
          {
            id: 1,
            name: 'Google',
            url: 'https://www.google.com',
            description: 'ÂÖ®ÁêÉÊêúÁ¥¢ÂºïÊìé',
            icon: 'G',
            tags: ['ÊêúÁ¥¢', 'Â∑•ÂÖ∑'],
            order: 1
          },
          {
            id: 2,
            name: 'GitHub',
            url: 'https://github.com',
            description: '‰ª£Á†ÅÊâòÁÆ°Âπ≥Âè∞',
            icon: 'GH',
            tags: ['ÂºÄÂèë', '‰ª£Á†Å'],
            order: 2
          }
        ]
      },
      {
        id: 2,
        name: 'Á§æ‰∫§Âπ≥Âè∞',
        description: 'Á§æ‰∫§ÁΩëÁªúÂπ≥Âè∞',
        icon: 'üí¨',
        hidden: false,
        order: 2,
        sites: [
          {
            id: 3,
            name: 'Twitter',
            url: 'https://twitter.com',
            description: 'ÂæÆÂçöÂÆ¢Âπ≥Âè∞',
            icon: 'T',
            tags: ['Á§æ‰∫§', 'Êñ∞Èóª'],
            order: 1
          }
        ]
      },
      {
        id: 3,
        name: 'Â≠¶‰π†ËµÑÊ∫ê',
        description: 'Âú®Á∫øÂ≠¶‰π†Âπ≥Âè∞',
        icon: 'üìö',
        hidden: true,
        order: 3,
        sites: [
          {
            id: 4,
            name: 'MDN',
            url: 'https://developer.mozilla.org',
            description: 'WebÂºÄÂèëÊñáÊ°£',
            icon: 'M',
            tags: ['ÊñáÊ°£', 'ÂºÄÂèë'],
            order: 1
          }
        ]
      }
    ],
    customLinks: [],
    statistics: {
      totalVisits: 0,
      lastReset: new Date().toISOString(),
      categoryCount: 3,
      siteCount: 4
    },
    version: '1.0.0',
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString()
  };
}

/**
 * Êï∞ÊçÆËøÅÁßª
 */
function migrateData(data) {
  // Â¶ÇÊûúÊ≤°ÊúâÁâàÊú¨Âè∑ÔºåËßÜ‰∏∫ÊóßÊï∞ÊçÆ
  if (!data.version) {
    // Ê∑ªÂä†ÁâàÊú¨Âè∑
    data.version = '1.0.0';
    
    // Á°Æ‰øùÊâÄÊúâÂøÖË¶ÅÁöÑÂ≠óÊÆµÈÉΩÂ≠òÂú®
    if (!data.config) {
      data.config = {
        bgColor: '#f8fafc',
        bgImage: '',
        theme: 'light'
      };
    }
    
    if (!data.statistics) {
      data.statistics = {
        totalVisits: 0,
        lastReset: new Date().toISOString(),
        categoryCount: data.categories?.length || 0,
        siteCount: data.categories?.reduce((sum, cat) => sum + (cat.sites?.length || 0), 0) || 0
      };
    }
  }
  
  return data;
}

/**
 * Â§á‰ªΩÊï∞ÊçÆ
 */
export async function backupData(env, backupName = null) {
  try {
    const data = await loadNavData(env);
    const backupId = backupName || `backup_${new Date().toISOString().replace(/[:.]/g, '-')}`;
    
    await env.NAV_STORE.put(`backup_${backupId}`, JSON.stringify(data));
    
    return {
      success: true,
      backupId,
      timestamp: new Date().toISOString(),
      dataSize: JSON.stringify(data).length
    };
  } catch (error) {
    console.error('Error backing up data:', error);
    return { success: false, error: error.message };
  }
}

/**
 * ÊÅ¢Â§çÂ§á‰ªΩÊï∞ÊçÆ
 */
export async function restoreBackup(env, backupId) {
  try {
    const backupData = await env.NAV_STORE.get(`backup_${backupId}`);
    
    if (!backupData) {
      return { success: false, error: 'Backup not found' };
    }
    
    const data = JSON.parse(backupData);
    await saveNavData(env, data);
    
    return {
      success: true,
      backupId,
      restoredAt: new Date().toISOString()
    };
  } catch (error) {
    console.error('Error restoring backup:', error);
    return { success: false, error: error.message };
  }
}

/**
 * Ëé∑ÂèñÂ§á‰ªΩÂàóË°®
 */
export async function listBackups(env) {
  try {
    const keys = await env.NAV_STORE.list({ prefix: 'backup_' });
    
    const backups = [];
    for (const key of keys.keys) {
      const backupData = await env.NAV_STORE.get(key.name);
      if (backupData) {
        const data = JSON.parse(backupData);
        backups.push({
          id: key.name.replace('backup_', ''),
          createdAt: data.createdAt || key.metadata?.createdAt,
          size: backupData.length,
          siteCount: data.statistics?.siteCount || 0,
          categoryCount: data.statistics?.categoryCount || 0
        });
      }
    }
    
    // ÊåâÊó∂Èó¥ÂÄíÂ∫èÊéíÂ∫è
    backups.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
    
    return { success: true, backups };
  } catch (error) {
    console.error('Error listing backups:', error);
    return { success: false, error: error.message };
  }
}

/**
 * Âà†Èô§Â§á‰ªΩ
 */
export async function deleteBackup(env, backupId) {
  try {
    await env.NAV_STORE.delete(`backup_${backupId}`);
    return { success: true };
  } catch (error) {
    console.error('Error deleting backup:', error);
    return { success: false, error: error.message };
  }
}

/**
 * ÂØºÂá∫Êï∞ÊçÆ‰∏∫ JSON
 */
export async function exportData(env) {
  const data = await loadNavData(env);
  return {
    success: true,
    data,
    exportDate: new Date().toISOString(),
    format: 'dao-hang-v1'
  };
}

/**
 * ÂØºÂÖ•Êï∞ÊçÆ
 */
export async function importData(env, importData) {
  try {
    // È™åËØÅÂØºÂÖ•Êï∞ÊçÆÊ†ºÂºè
    if (!importData.categories || !Array.isArray(importData.categories)) {
      return { success: false, error: 'Invalid data format' };
    }
    
    // Â§á‰ªΩÂΩìÂâçÊï∞ÊçÆ
    await backupData(env, 'pre_import_backup');
    
    // ‰øùÂ≠òÂØºÂÖ•ÁöÑÊï∞ÊçÆ
    await saveNavData(env, importData);
    
    return {
      success: true,
      importedAt: new Date().toISOString(),
      categoryCount: importData.categories.length,
      siteCount: importData.categories.reduce((sum, cat) => sum + (cat.sites?.length || 0), 0)
    };
  } catch (error) {
    console.error('Error importing data:', error);
    return { success: false, error: error.message };
  }
}
```

---

## 9. `src/templates.js` - HTMLÊ®°Êùø

```javascript
/**
 * HTML Ê®°ÊùøÊ®°Âùó
 * ÂåÖÂê´ÊâÄÊúâÈ°µÈù¢ÁöÑHTMLÊ®°Êùø
 */

/**
 * ÁîüÊàê‰∏ªÈ°µHTML
 */
export function generateHomePage(navData, env) {
  const { siteName, description, config, categories } = navData;
  const bgStyle = config.bgImage 
    ? `background-image: url('${config.bgImage}'); background-size: cover; background-attachment: fixed;`
    : `background-color: ${config.bgColor || '#f8fafc'};`;
  
  return `
    <!DOCTYPE html>
    <html lang="zh-CN">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>${siteName}</title>
      <meta name="description" content="${description}">
      <link rel="icon" href="/public/favicon.ico" type="image/x-icon">
      
      <style>
        :root {
          --primary-color: #667eea;
          --secondary-color: #764ba2;
          --bg-color: ${config.bgColor || '#f8fafc'};
          --text-color: #2d3748;
          --card-bg: rgba(255, 255, 255, 0.95);
          --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
          --radius: 16px;
          --transition: all 0.3s ease;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
          color: var(--text-color);
          ${bgStyle}
          min-height: 100vh;
          transition: var(--transition);
        }
        
        .container {
          max-width: 1200px;
          margin: 0 auto;
          padding: 20px;
        }
        
        header {
          text-align: center;
          padding: 60px 20px 40px;
          backdrop-filter: blur(10px);
          background: rgba(255, 255, 255, 0.8);
          border-radius: var(--radius);
          margin-bottom: 40px;
          box-shadow: var(--shadow);
        }
        
        h1 {
          font-size: 3rem;
          font-weight: 700;
          margin-bottom: 10px;
          background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
        }
        
        .site-description {
          font-size: 1.2rem;
          color: #718096;
          max-width: 600px;
          margin: 0 auto 30px;
        }
        
        .categories {
          display: flex;
          flex-direction: column;
          gap: 30px;
        }
        
        .category {
          background: var(--card-bg);
          border-radius: var(--radius);
          overflow: hidden;
          box-shadow: var(--shadow);
          transition: var(--transition);
        }
        
        .category:hover {
          transform: translateY(-5px);
          box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }
        
        .category-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 25px 30px;
          cursor: pointer;
          background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
          color: white;
        }
        
        .category-header h2 {
          display: flex;
          align-items: center;
          gap: 12px;
          font-size: 1.5rem;
          font-weight: 600;
        }
        
        .category-icon {
          font-size: 1.8rem;
        }
        
        .toggle-btn {
          background: rgba(255, 255, 255, 0.2);
          border: none;
          width: 40px;
          height: 40px;
          border-radius: 50%;
          color: white;
          font-size: 1.5rem;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: var(--transition);
        }
        
        .toggle-btn:hover {
          background: rgba(255, 255, 255, 0.3);
          transform: rotate(90deg);
        }
        
        .category-description {
          padding: 0 30px 20px;
          color: #718096;
          font-size: 1rem;
          border-bottom: 1px solid #e2e8f0;
        }
        
        .sites {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
          gap: 20px;
          padding: 30px;
          ${config.layout === 'list' ? 'grid-template-columns: 1fr;' : ''}
        }
        
        .site-card {
          background: white;
          border-radius: 12px;
          padding: 25px;
          text-decoration: none;
          color: var(--text-color);
          transition: var(--transition);
          border: 1px solid #e2e8f0;
          display: flex;
          align-items: center;
          gap: 20px;
        }
        
        .site-card:hover {
          transform: translateY(-3px);
          box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
          border-color: var(--primary-color);
        }
        
        .site-icon {
          width: 60px;
          height: 60px;
          border-radius: 12px;
          background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
          font-size: 1.5rem;
          font-weight: bold;
          flex-shrink: 0;
        }
        
        .site-info {
          flex: 1;
        }
        
        .site-info h3 {
          margin: 0 0 8px;
          font-size: 1.2rem;
          font-weight: 600;
        }
        
        .site-info p {
          margin: 0;
          color: #718096;
          font-size: 0.95rem;
          line-height: 1.5;
        }
        
        .site-tags {
          display: flex;
          flex-wrap: wrap;
          gap: 6px;
          margin-top: 10px;
        }
        
        .tag {
          background: #edf2f7;
          color: #4a5568;
          padding: 4px 10px;
          border-radius: 20px;
          font-size: 0.8rem;
        }
        
        .admin-link {
          position: fixed;
          bottom: 30px;
          right: 30px;
          background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
          color: white;
          padding: 15px 25px;
          border-radius: 50px;
          text-decoration: none;
          font-weight: 600;
          box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
          transition: var(--transition);
          z-index: 1000;
        }
        
        .admin-link:hover {
          transform: translateY(-3px);
          box-shadow: 0 15px 35px rgba(102, 126, 234, 0.5);
        }
        
        .footer {
          text-align: center;
          padding: 40px 20px;
          margin-top: 60px;
          color: #718096;
          font-size: 0.9rem;
          border-top: 1px solid #e2e8f0;
        }
        
        .hidden .sites {
          display: none;
        }
        
        @media (max-width: 768px) {
          .container {
            padding: 10px;
          }
          
          header {
            padding: 40px 20px 30px;
            margin-bottom: 30px;
          }
          
          h1 {
            font-size: 2.2rem;
          }
          
          .sites {
            grid-template-columns: 1fr;
            padding: 20px;
          }
          
          .category-header {
            padding: 20px;
          }
          
          .admin-link {
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            font-size: 0.9rem;
          }
        }
        
        @media (max-width: 480px) {
          .site-card {
            flex-direction: column;
            text-align: center;
            padding: 20px;
          }
          
          .site-icon {
            margin-bottom: 15px;
          }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <header>
          <h1>${siteName}</h1>
          <p class="site-description">${description}</p>
        </header>
        
        <div class="categories">
          ${categories.map(category => `
            <div class="category ${category.hidden ? 'hidden' : ''}" id="category-${category.id}">
              <div class="category-header" onclick="toggleCategory(${category.id})">
                <h2>
                  <span class="category-icon">${category.icon || 'üìÇ'}</span>
                  ${category.name}
                </h2>
                <button class="toggle-btn">${category.hidden ? '+' : '‚àí'}</button>
              </div>
              
              ${category.description ? `
                <div class="category-description">
                  ${category.description}
                </div>
              ` : ''}
              
              <div class="sites">
                ${category.sites.map(site => `
                  <a href="${site.url}" target="_blank" rel="noopener" class="site-card">
                    <div class="site-icon">${site.icon || site.name.charAt(0)}</div>
                    <div class="site-info">
                      <h3>${site.name}</h3>
                      <p>${site.description || ''}</p>
                      ${site.tags && site.tags.length > 0 ? `
                        <div class="site-tags">
                          ${site.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                      ` : ''}
                    </div>
                  </a>
                `).join('')}
              </div>
            </div>
          `).join('')}
        </div>
        
        <div class="footer">
          <p>¬© ${new Date().getFullYear()} ${siteName} | Âü∫‰∫é Cloudflare Workers ÊûÑÂª∫</p>
          <p>ÁâàÊú¨: ${env.VERSION || '1.0.0'} | ÊúÄÂêéÊõ¥Êñ∞: ${navData.updatedAt ? new Date(navData.updatedAt).toLocaleDateString('zh-CN') : 'ÂàöÂàö'}</p>
        </div>
      </div>
      
      <a href="/admin" class="admin-link">ÁÆ°ÁêÜÂêéÂè∞</a>
      
      <script>
        // ‰ªé localStorage ÊÅ¢Â§çÂàÜÁ±ªÁä∂ÊÄÅ
        document.addEventListener('DOMContentLoaded', () => {
          const hiddenCategories = JSON.parse(localStorage.getItem('dao_hang_hidden_categories') || '{}');
          Object.keys(hiddenCategories).forEach(id => {
            if (hiddenCategories[id]) {
              const category = document.getElementById('category-' + id);
              if (category) {
                category.classList.add('hidden');
                const toggleBtn = category.querySelector('.toggle-btn');
                if (toggleBtn) toggleBtn.textContent = '+';
              }
            }
          });
          
          // Êõ¥Êñ∞ËÆøÈóÆÁªüËÆ°
          updateVisitCount();
        });
        
        function toggleCategory(id) {
          const category = document.getElementById('category-' + id);
          const toggleBtn = category.querySelector('.toggle-btn');
          
          if (category.classList.contains('hidden')) {
            category.classList.remove('hidden');
            toggleBtn.textContent = '‚àí';
          } else {
            category.classList.add('hidden');
            toggleBtn.textContent = '+';
          }
          
          // ‰øùÂ≠òÁä∂ÊÄÅÂà∞ localStorage
          const hiddenCategories = JSON.parse(localStorage.getItem('dao_hang_hidden_categories') || '{}');
          hiddenCategories[id] = category.classList.contains('hidden');
          localStorage.setItem('dao_hang_hidden_categories', JSON.stringify(hiddenCategories));
        }
        
        async function updateVisitCount() {
          try {
            await fetch('/api/stats/visit', { method: 'POST' });
          } catch (error) {
            console.log('ÁªüËÆ°Êõ¥Êñ∞Â§±Ë¥•:', error);
          }
        }
        
        // Âø´Êç∑ÈîÆÊîØÊåÅ
        document.addEventListener('keydown', (e) => {
          // Ctrl+/ Êàñ Cmd+/ ÊòæÁ§∫Â∏ÆÂä©
          if ((e.ctrlKey || e.metaKey) && e.key === '/') {
            e.preventDefault();
            alert('Âø´Êç∑ÈîÆÂ∏ÆÂä©Ôºö\\n\\nÊï∞Â≠óÈîÆ 1-9: Â±ïÂºÄÂØπÂ∫îÂàÜÁ±ª\\nÊï∞Â≠óÈîÆ 0: Â±ïÂºÄ/ÈöêËóèÊâÄÊúâÂàÜÁ±ª\\nESC: ËøîÂõûÈ¶ñÈ°µ\\nG + A: ÂâçÂæÄÁÆ°ÁêÜÂêéÂè∞');
          }
          
          // ESC ËøîÂõûÈ¶ñÈ°µ
          if (e.key === 'Escape') {
            window.location.href = '/';
          }
          
          // G + A ÂâçÂæÄÁÆ°ÁêÜÂêéÂè∞
          if (e.key === 'a' && (e.ctrlKey || e.metaKey)) {
            window.location.href = '/admin';
          }
          
          // Êï∞Â≠óÈîÆ 1-9 ÂàáÊç¢ÂàÜÁ±ª
          if (e.key >= '1' && e.key <= '9') {
            const index = parseInt(e.key) - 1;
            const categories = document.querySelectorAll('.category');
            if (categories[index]) {
              const id = categories[index].id.replace('category-', '');
              toggleCategory(id);
            }
          }
          
          // Êï∞Â≠óÈîÆ 0 ÂàáÊç¢ÊâÄÊúâÂàÜÁ±ª
          if (e.key === '0') {
            const categories = document.querySelectorAll('.category');
            const allHidden = Array.from(categories).every(cat => cat.classList.contains('hidden'));
            
            categories.forEach(category => {
              const id = category.id.replace('category-', '');
              const toggleBtn = category.querySelector('.toggle-btn');
              
              if (allHidden) {
                category.classList.remove('hidden');
                if (toggleBtn) toggleBtn.textContent = '‚àí';
              } else {
                category.classList.add('hidden');
                if (toggleBtn) toggleBtn.textContent = '+';
              }
            });
          }
        });
      </script>
    </body>
    </html>
  `;
}

/**
 * ÁîüÊàêÁÆ°ÁêÜÂêéÂè∞HTML
 */
export function generateAdminPage(navData, env) {
  const { siteName, config, categories } = navData;
  
  return `
    <!DOCTYPE html>
    <html lang="zh-CN">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>ÁÆ°ÁêÜÂêéÂè∞ - ${siteName}</title>
      
      <style>
        :root {
          --primary-color: #667eea;
          --secondary-color: #764ba2;
          --sidebar-width: 260px;
          --header-height: 70px;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
          background: #f5f7fa;
          color: #2d3748;
          min-height: 100vh;
          overflow-x: hidden;
        }
        
        .admin-container {
          display: flex;
          min-height: 100vh;
        }
        
        /* ‰æßËæπÊ†èÊ†∑Âºè */
        .sidebar {
          width: var(--sidebar-width);
          background: linear-gradient(180deg, var(--primary-color) 0%, var(--secondary-color) 100%);
          color: white;
          position: fixed;
          top: 0;
          left: 0;
          bottom: 0;
          z-index: 100;
          box-shadow: 5px 0 20px rgba(0, 0, 0, 0.1);
          transition: transform 0.3s ease;
        }
        
        .sidebar-header {
          padding: 25px 20px;
          border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sidebar-header h2 {
          font-size: 1.3rem;
          font-weight: 600;
          display: flex;
          align-items: center;
          gap: 10px;
        }
        
        .sidebar-menu {
          list-style: none;
          padding: 20px 0;
        }
        
        .menu-item {
          padding: 0;
        }
        
        .menu-link {
          display: flex;
          align-items: center;
          gap: 12px;
          padding: 15px 25px;
          color: rgba(255, 255, 255, 0.9);
          text-decoration: none;
          font-weight: 500;
          transition: all 0.2s;
          border-left: 4px solid transparent;
        }
        
        .menu-link:hover, .menu-link.active {
          background: rgba(255, 255, 255, 0.1);
          color: white;
          border-left-color: white;
        }
        
        .menu-icon {
          font-size: 1.2rem;
          width: 24px;
          text-align: center;
        }
        
        /* ‰∏ªÂÜÖÂÆπÂå∫Ê†∑Âºè */
        .main-content {
          flex: 1;
          margin-left: var(--sidebar-width);
          min-height: 100vh;
          transition: margin-left 0.3s ease;
        }
        
        .header {
          height: var(--header-height);
          background: white;
          border-bottom: 1px solid #e2e8f0;
          padding: 0 30px;
          display: flex;
          align-items: center;
          justify-content: space-between;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .header-left h1 {
          font-size: 1.5rem;
          font-weight: 600;
          color: #2d3748;
        }
        
        .header-right {
          display: flex;
          align-items: center;
          gap: 20px;
        }
        
        .user-info {
          display: flex;
          align-items: center;
          gap: 10px;
        }
        
        .avatar {
          width: 40px;
          height: 40px;
          border-radius: 50%;
          background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
          color: white;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: bold;
        }
        
        .logout-btn {
          background: #fed7d7;
          color: #9b2c2c;
          border: none;
          padding: 8px 16px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
          transition: all 0.2s;
        }
        
        .logout-btn:hover {
          background: #feb2b2;
        }
        
        /* ÂÜÖÂÆπÂå∫Ê†∑Âºè */
        .content {
          padding: 30px;
        }
        
        .section {
          background: white;
          border-radius: 12px;
          padding: 30px;
          margin-bottom: 30px;
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
        
        .section h2 {
          font-size: 1.5rem;
          font-weight: 600;
          margin-bottom: 25px;
          color: #2d3748;
          display: flex;
          align-items: center;
          gap: 10px;
        }
        
        /* Ë°®ÂçïÊ†∑Âºè */
        .form-group {
          margin-bottom: 24px;
        }
        
        .form-label {
          display: block;
          margin-bottom: 8px;
          font-weight: 500;
          color: #4a5568;
        }
        
        .form-control {
          width: 100%;
          padding: 12px 16px;
          border: 2px solid #e2e8f0;
          border-radius: 8px;
          font-size: 1rem;
          transition: border-color 0.2s;
        }
        
        .form-control:focus {
          outline: none;
          border-color: var(--primary-color);
        }
        
        .form-text {
          font-size: 0.875rem;
          color: #718096;
          margin-top: 6px;
        }
        
        .btn {
          padding: 12px 24px;
          border: none;
          border-radius: 8px;
          font-size: 1rem;
          font-weight: 500;
          cursor: pointer;
          transition: all 0.2s;
        }
        
        .btn-primary {
          background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
          color: white;
        }
        
        .btn-primary:hover {
          transform: translateY(-2px);
          box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }
        
        .btn-danger {
          background: #fc8181;
          color: white;
        }
        
        .btn-danger:hover {
          background: #f56565;
        }
        
        /* ÂàÜÁ±ªÁÆ°ÁêÜÊ†∑Âºè */
        .category-manager {
          margin-bottom: 40px;
        }
        
        .category-card {
          background: #f8fafc;
          border-radius: 10px;
          padding: 20px;
          margin-bottom: 20px;
          border: 2px solid #e2e8f0;
        }
        
        .category-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
        }
        
        .category-title {
          font-size: 1.2rem;
          font-weight: 600;
          color: #2d3748;
        }
        
        .site-list {
          margin-top: 20px;
        }
        
        .site-item {
          background: white;
          border: 1px solid #e2e8f0;
          border-radius: 8px;
          padding: 15px;
          margin-bottom: 10px;
          display: flex;
          align-items: center;
          gap: 15px;
        }
        
        .site-drag {
          cursor: move;
          color: #a0aec0;
        }
        
        .site-input {
          flex: 1;
          padding: 8px 12px;
          border: 1px solid #e2e8f0;
          border-radius: 6px;
        }
        
        .add-btn, .remove-btn {
          background: none;
          border: none;
          font-size: 1.2rem;
          cursor: pointer;
          padding: 5px;
        }
        
        .add-btn { color: #48bb78; }
        .remove-btn { color: #f56565; }
        
        /* ËÉåÊôØËÆæÁΩÆÊ†∑Âºè */
        .bg-preview {
          width: 200px;
          height: 100px;
          border-radius: 8px;
          border: 2px dashed #cbd5e0;
          display: flex;
          align-items: center;
          justify-content: center;
          margin-top: 10px;
          overflow: hidden;
        }
        
        .bg-preview img {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }
        
        /* Êñá‰ª∂‰∏ä‰º†Ê†∑Âºè */
        .upload-area {
          border: 2px dashed #cbd5e0;
          border-radius: 8px;
          padding: 40px;
          text-align: center;
          cursor: pointer;
          transition: all 0.2s;
        }
        
        .upload-area:hover {
          border-color: var(--primary-color);
          background: #f8fafc;
        }
        
        .upload-icon {
          font-size: 3rem;
          color: #a0aec0;
          margin-bottom: 15px;
        }
        
        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 992px) {
          .sidebar {
            transform: translateX(-100%);
          }
          
          .sidebar.active {
            transform: translateX(0);
          }
          
          .main-content {
            margin-left: 0;
          }
          
          .menu-toggle {
            display: block;
          }
        }
        
        @media (max-width: 768px) {
          .content {
            padding: 20px;
          }
          
          .section {
            padding: 20px;
          }
          
          .header {
            padding: 0 20px;
          }
          
          .site-item {
            flex-direction: column;
            align-items: stretch;
          }
        }
        
        /* Âä†ËΩΩÂä®Áîª */
        .spinner {
          width: 40px;
          height: 40px;
          border: 4px solid #e2e8f0;
          border-top-color: var(--primary-color);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
          to { transform: rotate(360deg); }
        }
        
        /* Ê∂àÊÅØÊèêÁ§∫ */
        .message {
          padding: 15px;
          border-radius: 8px;
          margin-bottom: 20px;
          display: none;
        }
        
        .message.success {
          background: #c6f6d5;
          color: #22543d;
          border: 1px solid #9ae6b4;
        }
        
        .message.error {
          background: #fed7d7;
          color: #742a2a;
          border: 1px solid #fc8181;
        }
        
        .message.info {
          background: #bee3f8;
          color: #2c5282;
          border: 1px solid #90cdf4;
        }
      </style>
    </head>
    <body>
      <div class="admin-container">
        <!-- ‰æßËæπÊ†è -->
        <div class="sidebar" id="sidebar">
          <div class="sidebar-header">
            <h2>üìä ÂØºËà™ÁÆ°ÁêÜ</h2>
          </div>
          <ul class="sidebar-menu">
            <li class="menu-item">
              <a href="#dashboard" class="menu-link active" onclick="showSection('dashboard')">
                <span class="menu-icon">üìà</span>
                <span>ÊéßÂà∂Èù¢Êùø</span>
              </a>
            </li>
            <li class="menu-item">
              <a href="#settings" class="menu-link" onclick="showSection('settings')">
                <span class="menu-icon">‚öôÔ∏è</span>
                <span>ÁΩëÁ´ôËÆæÁΩÆ</span>
              </a>
            </li>
            <li class="menu-item">
              <a href="#categories" class="menu-link" onclick="showSection('categories')">
                <span class="menu-icon">üìÅ</span>
                <span>ÂàÜÁ±ªÁÆ°ÁêÜ</span>
              </a>
            </li>
            <li class="menu-item">
              <a href="#background" class="menu-link" onclick="showSection('background')">
                <span class="menu-icon">üé®</span>
                <span>ËÉåÊôØËÆæÁΩÆ</span>
              </a>
            </li>
            <li class="menu-item">
              <a href="#backup" class="menu-link" onclick="showSection('backup')">
                <span class="menu-icon">üíæ</span>
                <span>Êï∞ÊçÆÂ§á‰ªΩ</span>
              </a>
            </li>
            <li class="menu-item">
              <a href="/" target="_blank" class="menu-link">
                <span class="menu-icon">üëÅÔ∏è</span>
                <span>Êü•ÁúãÁΩëÁ´ô</span>
              </a>
            </li>
          </ul>
        </div>
        
        <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
        <div class="main-content">
          <!-- È°∂ÈÉ®Ê†è -->
          <div class="header">
            <div class="header-left">
              <h1>ÁÆ°ÁêÜÂêéÂè∞</h1>
            </div>
            <div class="header-right">
              <div class="user-info">
                <div class="avatar">${env.ADMIN_USERNAME?.charAt(0).toUpperCase() || 'A'}</div>
                <span>${env.ADMIN_USERNAME || 'ÁÆ°ÁêÜÂëò'}</span>
              </div>
              <button class="logout-btn" onclick="logout()">ÈÄÄÂá∫ÁôªÂΩï</button>
            </div>
          </div>
          
          <!-- ÂÜÖÂÆπÂå∫ -->
          <div class="content">
            <!-- Ê∂àÊÅØÊèêÁ§∫ -->
            <div id="message" class="message"></div>
            
            <!-- ÊéßÂà∂Èù¢Êùø -->
            <div id="dashboard-section" class="section">
              <h2><span>üìà</span> ÊéßÂà∂Èù¢Êùø</h2>
              <div class="stats-grid">
                <div class="stat-card">
                  <h3>ÁΩëÁ´ôÁªüËÆ°</h3>
                  <p>ÂàÜÁ±ªÊï∞Èáè: <span id="category-count">${categories.length}</span></p>
                  <p>ÁΩëÁ´ôÊï∞Èáè: <span id="site-count">${categories.reduce((sum, cat) => sum + cat.sites.length, 0)}</span></p>
                  <p>ÊúÄÂêéÊõ¥Êñ∞: <span id="last-updated">${navData.updatedAt ? new Date(navData.updatedAt).toLocaleString('zh-CN') : 'Êú™Áü•'}</span></p>
                </div>
                <div class="stat-card">
                  <h3>Á≥ªÁªü‰ø°ÊÅØ</h3>
                  <p>ÁâàÊú¨: ${env.VERSION || '1.0.0'}</p>
                  <p>ÁéØÂ¢É: ${env.ENVIRONMENT || 'production'}</p>
                  <p>Â≠òÂÇ®: Cloudflare KV</p>
                </div>
              </div>
            </div>
            
            <!-- ÁΩëÁ´ôËÆæÁΩÆ -->
            <div id="settings-section" class="section" style="display: none;">
              <h2><span>‚öôÔ∏è</span> ÁΩëÁ´ôËÆæÁΩÆ</h2>
              <div class="form-group">
                <label class="form-label">ÁΩëÁ´ôÂêçÁß∞</label>
                <input type="text" class="form-control" id="site-name" value="${navData.siteName}">
              </div>
              <div class="form-group">
                <label class="form-label">ÁΩëÁ´ôÊèèËø∞</label>
                <textarea class="form-control" id="site-description" rows="3">${navData.description}</textarea>
              </div>
              <button class="btn btn-primary" onclick="saveSettings()">‰øùÂ≠òËÆæÁΩÆ</button>
            </div>
            
            <!-- ÂàÜÁ±ªÁÆ°ÁêÜ -->
            <div id="categories-section" class="section" style="display: none;">
              <h2><span>üìÅ</span> ÂàÜÁ±ªÁÆ°ÁêÜ</h2>
              <div id="categories-container">
                ${categories.map((category, catIndex) => `
                  <div class="category-card" data-index="${catIndex}">
                    <div class="category-header">
                      <div>
                        <input type="text" class="form-control" value="${category.name}" 
                               onchange="updateCategoryField(${catIndex}, 'name', this.value)" 
                               placeholder="ÂàÜÁ±ªÂêçÁß∞">
                      </div>
                      <div>
                        <button class="remove-btn" onclick="removeCategory(${catIndex})">üóëÔ∏è</button>
                        <button class="add-btn" onclick="addSite(${catIndex})">‚ûï</button>
                      </div>
                    </div>
                    
                    <div class="form-group">
                      <label class="form-label">ÂàÜÁ±ªÊèèËø∞</label>
                      <input type="text" class="form-control" value="${category.description || ''}" 
                             onchange="updateCategoryField(${catIndex}, 'description', this.value)" 
                             placeholder="ÂàÜÁ±ªÊèèËø∞">
                    </div>
                    
                    <div class="form-group">
                      <label class="form-label">
                        <input type="checkbox" ${category.hidden ? 'checked' : ''} 
                               onchange="updateCategoryField(${catIndex}, 'hidden', this.checked)">
                        ÈªòËÆ§ÈöêËóèÊ≠§ÂàÜÁ±ª
                      </label>
                    </div>
                    
                    <div class="site-list">
                      <h4>ÁΩëÁ´ôÂàóË°®</h4>
                      ${category.sites.map((site, siteIndex) => `
                        <div class="site-item" data-site-index="${siteIndex}">
                          <span class="site-drag">‚ò∞</span>
                          <input type="text" class="site-input" value="${site.name}" 
                                 placeholder="ÁΩëÁ´ôÂêçÁß∞" 
                                 onchange="updateSiteField(${catIndex}, ${siteIndex}, 'name', this.value)">
                          <input type="text" class="site-input" value="${site.url}" 
                                 placeholder="URL (https://...)" 
                                 onchange="updateSiteField(${catIndex}, ${siteIndex}, 'url', this.value)">
                          <input type="text" class="site-input" value="${site.description || ''}" 
                                 placeholder="ÊèèËø∞" 
                                 onchange="updateSiteField(${catIndex}, ${siteIndex}, 'description', this.value)">
                          <button class="remove-btn" onclick="removeSite(${catIndex}, ${siteIndex})">üóëÔ∏è</button>
                        </div>
                      `).join('')}
                    </div>
                  </div>
                `).join('')}
              </div>
              
              <button class="btn btn-primary" onclick="addCategory()">‚ûï Ê∑ªÂä†ÂàÜÁ±ª</button>
              <button class="btn btn-primary" onclick="saveCategories()" style="margin-left: 10px;">üíæ ‰øùÂ≠òÊâÄÊúâÊõ¥Êîπ</button>
            </div>
            
            <!-- ËÉåÊôØËÆæÁΩÆ -->
            <div id="background-section" class="section" style="display: none;">
              <h2><span>üé®</span> ËÉåÊôØËÆæÁΩÆ</h2>
              <div class="form-group">
                <label class="form-label">ËÉåÊôØÈ¢úËâ≤</label>
                <input type="color" class="form-control" id="bg-color" value="${config.bgColor || '#f8fafc'}" 
                       style="width: 100px; height: 40px;">
              </div>
              
              <div class="form-group">
                <label class="form-label">ËÉåÊôØÂõæÁâá URL</label>
                <input type="text" class="form-control" id="bg-image" value="${config.bgImage || ''}" 
                       placeholder="ËæìÂÖ•ÂõæÁâáÈìæÊé•">
                <div class="form-text">ÊîØÊåÅ JPG„ÄÅPNG„ÄÅWebP Ê†ºÂºèÔºåÂª∫ËÆÆÂ∞∫ÂØ∏ 1920x1080</div>
                
                ${config.bgImage ? `
                  <div class="bg-preview">
                    <img src="${config.bgImage}" alt="ËÉåÊôØÈ¢ÑËßà" onerror="this.style.display='none'">
                  </div>
                ` : `
                  <div class="bg-preview" style="display: none;">
                    <img id="bg-preview-img" alt="ËÉåÊôØÈ¢ÑËßà">
                  </div>
                `}
              </div>
              
              <div class="form-group">
                <label class="form-label">Êàñ‰∏ä‰º†ËÉåÊôØÂõæÁâá</label>
                <div class="upload-area" onclick="document.getElementById('bg-upload').click()">
                  <div class="upload-icon">üìÅ</div>
                  <p>ÁÇπÂáªÊàñÊãñÊîæÊñá‰ª∂Âà∞Ê≠§Âå∫Âüü‰∏ä‰º†</p>
                  <p class="form-text">ÊîØÊåÅ JPG„ÄÅPNG„ÄÅWebPÔºåÊúÄÂ§ß 5MB</p>
                </div>
                <input type="file" id="bg-upload" accept="image/*" style="display: none;" 
                       onchange="uploadBackgroundImage(this)">
              </div>
              
              <button class="btn btn-primary" onclick="saveBackground()">‰øùÂ≠òËÉåÊôØËÆæÁΩÆ</button>
            </div>
            
            <!-- Êï∞ÊçÆÂ§á‰ªΩ -->
            <div id="backup-section" class="section" style="display: none;">
              <h2><span>üíæ</span> Êï∞ÊçÆÂ§á‰ªΩ</h2>
              
              <div class="form-group">
                <h3>Á´ãÂç≥Â§á‰ªΩ</h3>
                <p>ÂàõÂª∫ÂΩìÂâçÊï∞ÊçÆÁöÑÊó∂Èó¥ÁÇπÂ§á‰ªΩ</p>
                <button class="btn btn-primary" onclick="createBackup()">ÂàõÂª∫Â§á‰ªΩ</button>
              </div>
              
              <div class="form-group">
                <h3>Â§á‰ªΩÂàóË°®</h3>
                <div id="backup-list">
                  <p>Âä†ËΩΩ‰∏≠...</p>
                </div>
              </div>
              
              <div class="form-group">
                <h3>Êï∞ÊçÆÂØºÂá∫/ÂØºÂÖ•</h3>
                <button class="btn btn-primary" onclick="exportData()">ÂØºÂá∫Êï∞ÊçÆ</button>
                <button class="btn btn-primary" onclick="importData()" style="margin-left: 10px;">ÂØºÂÖ•Êï∞ÊçÆ</button>
                <input type="file" id="import-file" accept=".json" style="display: none;" 
                       onchange="handleImportFile(this)">
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <script>
        // ÂΩìÂâçÁºñËæëÁöÑÊï∞ÊçÆ
        let currentData = ${JSON.stringify(navData)};
        let isLoading = false;
        
        // ÊòæÁ§∫Ê∂àÊÅØ
        function showMessage(text, type = 'info', duration = 5000) {
          const messageEl = document.getElementById('message');
          messageEl.textContent = text;
          messageEl.className = 'message ' + type;
          messageEl.style.display = 'block';
          
          if (duration > 0) {
            setTimeout(() => {
              messageEl.style.display = 'none';
            }, duration);
          }
        }
        
        // ÂàáÊç¢ÈÉ®ÂàÜÊòæÁ§∫
        function showSection(sectionId) {
          // ÈöêËóèÊâÄÊúâÈÉ®ÂàÜ
          document.querySelectorAll('.section').forEach(el => {
            el.style.display = 'none';
          });
          
          // ÊòæÁ§∫ÁõÆÊ†áÈÉ®ÂàÜ
          document.getElementById(sectionId + '-section').style.display = 'block';
          
          // Êõ¥Êñ∞ËèúÂçïÊøÄÊ¥ªÁä∂ÊÄÅ
          document.querySelectorAll('.menu-link').forEach(link => {
            link.classList.remove('active');
          });
          
          document.querySelector(\`a[href="#\${sectionId}"]\`).classList.add('active');
          
          // Â¶ÇÊûúÊòØÂ§á‰ªΩÈÉ®ÂàÜÔºåÂä†ËΩΩÂ§á‰ªΩÂàóË°®
          if (sectionId === 'backup') {
            loadBackupList();
          }
        }
        
        // Êõ¥Êñ∞ÂàÜÁ±ªÂ≠óÊÆµ
        function updateCategoryField(catIndex, field, value) {
          currentData.categories[catIndex][field] = value;
        }
        
        // Êõ¥Êñ∞ÁΩëÁ´ôÂ≠óÊÆµ
        function updateSiteField(catIndex, siteIndex, field, value) {
          currentData.categories[catIndex].sites[siteIndex][field] = value;
        }
        
        // Ê∑ªÂä†ÂàÜÁ±ª
        function addCategory() {
          const newCategory = {
            id: Date.now(),
            name: 'Êñ∞ÂàÜÁ±ª',
            description: '',
            icon: 'üìÅ',
            hidden: false,
            order: currentData.categories.length + 1,
            sites: []
          };
          
          currentData.categories.push(newCategory);
          renderCategories();
        }
        
        // ÁßªÈô§ÂàÜÁ±ª
        function removeCategory(catIndex) {
          if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÂàÜÁ±ªÂêóÔºüÂàÜÁ±ª‰∏ãÁöÑÊâÄÊúâÁΩëÁ´ô‰πü‰ºöË¢´Âà†Èô§„ÄÇ')) {
            currentData.categories.splice(catIndex, 1);
            renderCategories();
          }
        }
        
        // Ê∑ªÂä†ÁΩëÁ´ô
        function addSite(catIndex) {
          const newSite = {
            id: Date.now(),
            name: 'Êñ∞ÁΩëÁ´ô',
            url: 'https://',
            description: '',
            icon: '',
            tags: [],
            order: currentData.categories[catIndex].sites.length + 1
          };
          
          currentData.categories[catIndex].sites.push(newSite);
          renderCategories();
        }
        
        // ÁßªÈô§ÁΩëÁ´ô
        function removeSite(catIndex, siteIndex) {
          if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÁΩëÁ´ôÂêóÔºü')) {
            currentData.categories[catIndex].sites.splice(siteIndex, 1);
            renderCategories();
          }
        }
        
        // Ê∏≤ÊüìÂàÜÁ±ª
        function renderCategories() {
          const container = document.getElementById('categories-container');
          container.innerHTML = currentData.categories.map((category, catIndex) => \`
            <div class="category-card" data-index="\${catIndex}">
              <div class="category-header">
                <div>
                  <input type="text" class="form-control" value="\${category.name}" 
                         onchange="updateCategoryField(\${catIndex}, 'name', this.value)" 
                         placeholder="ÂàÜÁ±ªÂêçÁß∞">
                </div>
                <div>
                  <button class="remove-btn" onclick="removeCategory(\${catIndex})">üóëÔ∏è</button>
                  <button class="add-btn" onclick="addSite(\${catIndex})">‚ûï</button>
                </div>
              </div>
              
              <div class="form-group">
                <label class="form-label">ÂàÜÁ±ªÊèèËø∞</label>
                <input type="text" class="form-control" value="\${category.description || ''}" 
                       onchange="updateCategoryField(\${catIndex}, 'description', this.value)" 
                       placeholder="ÂàÜÁ±ªÊèèËø∞">
              </div>
              
              <div class="form-group">
                <label class="form-label">
                  <input type="checkbox" \${category.hidden ? 'checked' : ''} 
                         onchange="updateCategoryField(\${catIndex}, 'hidden', this.checked)">
                  ÈªòËÆ§ÈöêËóèÊ≠§ÂàÜÁ±ª
                </label>
              </div>
              
              <div class="site-list">
                <h4>ÁΩëÁ´ôÂàóË°®</h4>
                \${category.sites.map((site, siteIndex) => \`
                  <div class="site-item" data-site-index="\${siteIndex}">
                    <span class="site-drag">‚ò∞</span>
                    <input type="text" class="site-input" value="\${site.name}" 
                           placeholder="ÁΩëÁ´ôÂêçÁß∞" 
                           onchange="updateSiteField(\${catIndex}, \${siteIndex}, 'name', this.value)">
                    <input type="text" class="site-input" value="\${site.url}" 
                           placeholder="URL (https://...)" 
                           onchange="updateSiteField(\${catIndex}, \${siteIndex}, 'url', this.value)">
                    <input type="text" class="site-input" value="\${site.description || ''}" 
                           placeholder="ÊèèËø∞" 
                           onchange="updateSiteField(\${catIndex}, \${siteIndex}, 'description', this.value)">
                    <button class="remove-btn" onclick="removeSite(\${catIndex}, \${siteIndex})">üóëÔ∏è</button>
                  </div>
                \`).join('')}
              </div>
            </div>
          \`).join('');
          
          // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
          document.getElementById('category-count').textContent = currentData.categories.length;
          document.getElementById('site-count').textContent = currentData.categories.reduce((sum, cat) => sum + cat.sites.length, 0);
        }
        
        // ‰øùÂ≠òÁΩëÁ´ôËÆæÁΩÆ
        async function saveSettings() {
          if (isLoading) return;
          
          currentData.siteName = document.getElementById('site-name').value;
          currentData.description = document.getElementById('site-description').value;
          
          await saveToServer('settings');
        }
        
        // ‰øùÂ≠òÂàÜÁ±ª
        async function saveCategories() {
          if (isLoading) return;
          await saveToServer('categories');
        }
        
        // ‰øùÂ≠òËÉåÊôØËÆæÁΩÆ
        async function saveBackground() {
          if (isLoading) return;
          
          currentData.config.bgColor = document.getElementById('bg-color').value;
          currentData.config.bgImage = document.getElementById('bg-image').value;
          
          await saveToServer('background');
        }
        
        // ‰∏ä‰º†ËÉåÊôØÂõæÁâá
        async function uploadBackgroundImage(input) {
          const file = input.files[0];
          if (!file) return;
          
          // Ê£ÄÊü•Êñá‰ª∂Â§ßÂ∞èÔºà5MBÈôêÂà∂Ôºâ
          if (file.size > 5 * 1024 * 1024) {
            showMessage('Êñá‰ª∂Â§™Â§ßÔºåËØ∑ÈÄâÊã©Â∞è‰∫é5MBÁöÑÂõæÁâá', 'error');
            return;
          }
          
          // Ê£ÄÊü•Êñá‰ª∂Á±ªÂûã
          if (!file.type.startsWith('image/')) {
            showMessage('ËØ∑ÈÄâÊã©ÂõæÁâáÊñá‰ª∂', 'error');
            return;
          }
          
          try {
            showMessage('‰∏ä‰º†‰∏≠...', 'info', 0);
            isLoading = true;
            
            const formData = new FormData();
            formData.append('file', file);
            
            const response = await fetch('/api/upload', {
              method: 'POST',
              body: formData
            });
            
            const result = await response.json();
            
            if (result.success) {
              document.getElementById('bg-image').value = result.url;
              currentData.config.bgImage = result.url;
              
              // ÊòæÁ§∫È¢ÑËßà
              const previewEl = document.querySelector('.bg-preview');
              const imgEl = previewEl.querySelector('img') || document.getElementById('bg-preview-img');
              imgEl.src = result.url;
              previewEl.style.display = 'flex';
              
              showMessage('‰∏ä‰º†ÊàêÂäü', 'success');
            } else {
              showMessage('‰∏ä‰º†Â§±Ë¥•: ' + (result.error || 'Êú™Áü•ÈîôËØØ'), 'error');
            }
          } catch (error) {
            showMessage('‰∏ä‰º†Â§±Ë¥•: ' + error.message, 'error');
          } finally {
            isLoading = false;
            input.value = '';
          }
        }
        
        // ÂàõÂª∫Â§á‰ªΩ
        async function createBackup() {
          if (isLoading) return;
          
          try {
            showMessage('ÂàõÂª∫Â§á‰ªΩ‰∏≠...', 'info', 0);
            isLoading = true;
            
            const response = await fetch('/api/backup', {
              method: 'POST'
            });
            
            const result = await response.json();
            
            if (result.success) {
              showMessage(\`Â§á‰ªΩÂàõÂª∫ÊàêÂäü: \${result.backupId}\`, 'success');
              loadBackupList();
            } else {
              showMessage('Â§á‰ªΩÂ§±Ë¥•: ' + (result.error || 'Êú™Áü•ÈîôËØØ'), 'error');
            }
          } catch (error) {
            showMessage('Â§á‰ªΩÂ§±Ë¥•: ' + error.message, 'error');
          } finally {
            isLoading = false;
          }
        }
        
        // Âä†ËΩΩÂ§á‰ªΩÂàóË°®
        async function loadBackupList() {
          try {
            const response = await fetch('/api/backup/list');
            const result = await response.json();
            
            if (result.success) {
              const container = document.getElementById('backup-list');
              
              if (result.backups.length === 0) {
                container.innerHTML = '<p>ÊöÇÊó†Â§á‰ªΩ</p>';
                return;
              }
              
              container.innerHTML = result.backups.map(backup => \`
                <div class="backup-item" style="margin-bottom: 10px; padding: 10px; background: #f8fafc; border-radius: 6px;">
                  <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                      <strong>\${backup.id}</strong>
                      <p style="margin: 5px 0; font-size: 0.9em; color: #718096;">
                        ÂàõÂª∫Êó∂Èó¥: \${new Date(backup.createdAt).toLocaleString('zh-CN')}<br>
                        ÁΩëÁ´ôÊï∞: \${backup.siteCount} | ÂàÜÁ±ªÊï∞: \${backup.categoryCount}
                      </p>
                    </div>
                    <div>
                      <button onclick="restoreBackup('\${backup.id}')" style="margin-right: 5px;">ÊÅ¢Â§ç</button>
                      <button onclick="deleteBackup('\${backup.id}')" style="background: #fc8181; color: white;">Âà†Èô§</button>
                    </div>
                  </div>
                </div>
              \`).join('');
            }
          } catch (error) {
            console.error('Âä†ËΩΩÂ§á‰ªΩÂàóË°®Â§±Ë¥•:', error);
          }
        }
        
        // ÊÅ¢Â§çÂ§á‰ªΩ
        async function restoreBackup(backupId) {
          if (!confirm('Á°ÆÂÆöË¶ÅÊÅ¢Â§çÊ≠§Â§á‰ªΩÂêóÔºüÂΩìÂâçÊï∞ÊçÆÂ∞ÜË¢´Ë¶ÜÁõñ„ÄÇ')) return;
          
          try {
            showMessage('ÊÅ¢Â§çÂ§á‰ªΩ‰∏≠...', 'info', 0);
            isLoading = true;
            
            const response = await fetch(\`/api/backup/restore/\${backupId}\`, {
              method: 'POST'
            });
            
            const result = await response.json();
            
            if (result.success) {
              showMessage(\`Â§á‰ªΩÊÅ¢Â§çÊàêÂäü: \${backupId}\`, 'success');
              setTimeout(() => {
                location.reload();
              }, 1500);
            } else {
              showMessage('ÊÅ¢Â§çÂ§±Ë¥•: ' + (result.error || 'Êú™Áü•ÈîôËØØ'), 'error');
            }
          } catch (error) {
            showMessage('ÊÅ¢Â§çÂ§±Ë¥•: ' + error.message, 'error');
          } finally {
            isLoading = false;
          }
        }
        
        // Âà†Èô§Â§á‰ªΩ
        async function deleteBackup(backupId) {
          if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ê≠§Â§á‰ªΩÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ')) return;
          
          try {
            const response = await fetch(\`/api/backup/delete/\${backupId}\`, {
              method: 'DELETE'
            });
            
            const result = await response.json();
            
            if (result.success) {
              showMessage('Â§á‰ªΩÂà†Èô§ÊàêÂäü', 'success');
              loadBackupList();
            } else {
              showMessage('Âà†Èô§Â§±Ë¥•: ' + (result.error || 'Êú™Áü•ÈîôËØØ'), 'error');
            }
          } catch (error) {
            showMessage('Âà†Èô§Â§±Ë¥•: ' + error.message, 'error');
          }
        }
        
        // ÂØºÂá∫Êï∞ÊçÆ
        async function exportData() {
          try {
            const response = await fetch('/api/export');
            const result = await response.json();
            
            if (result.success) {
              // ÂàõÂª∫‰∏ãËΩΩÈìæÊé•
              const dataStr = JSON.stringify(result.data, null, 2);
              const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
              
              const exportFileDefaultName = \`dao-hang-backup-\${new Date().toISOString().slice(0, 10)}.json\`;
              
              const linkElement = document.createElement('a');
              linkElement.setAttribute('href', dataUri);
              linkElement.setAttribute('download', exportFileDefaultName);
              linkElement.click();
              
              showMessage('Êï∞ÊçÆÂØºÂá∫ÊàêÂäü', 'success');
            } else {
              showMessage('ÂØºÂá∫Â§±Ë¥•: ' + (result.error || 'Êú™Áü•ÈîôËØØ'), 'error');
            }
          } catch (error) {
            showMessage('ÂØºÂá∫Â§±Ë¥•: ' + error.message, 'error');
          }
        }
        
        // ÂØºÂÖ•Êï∞ÊçÆ
        function importData() {
          document.getElementById('import-file').click();
        }
        
        // Â§ÑÁêÜÂØºÂÖ•Êñá‰ª∂
        async function handleImportFile(input) {
          const file = input.files[0];
          if (!file) return;
          
          try {
            const text = await file.text();
            const data = JSON.parse(text);
            
            // È™åËØÅÊï∞ÊçÆÊ†ºÂºè
            if (!data.categories || !Array.isArray(data.categories)) {
              throw new Error('Êó†ÊïàÁöÑÊï∞ÊçÆÊ†ºÂºè');
            }
            
            if (!confirm(\`Á°ÆÂÆöË¶ÅÂØºÂÖ•Êï∞ÊçÆÂêóÔºüËøôÂ∞ÜÂØºÂÖ• \${data.categories.length} ‰∏™ÂàÜÁ±ªÂíå \${data.categories.reduce((sum, cat) => sum + (cat.sites?.length || 0), 0)} ‰∏™ÁΩëÁ´ô„ÄÇÂΩìÂâçÊï∞ÊçÆÂ∞ÜË¢´Ë¶ÜÁõñ„ÄÇ\`)) {
              return;
            }
            
            showMessage('ÂØºÂÖ•Êï∞ÊçÆ‰∏≠...', 'info', 0);
            
            const response = await fetch('/api/import', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: text
            });
            
            const result = await response.json();
            
            if (result.success) {
              showMessage(\`Êï∞ÊçÆÂØºÂÖ•ÊàêÂäüÔºÅÂØºÂÖ•‰∫Ü \${result.categoryCount} ‰∏™ÂàÜÁ±ªÂíå \${result.siteCount} ‰∏™ÁΩëÁ´ô\`, 'success');
              setTimeout(() => {
                location.reload();
              }, 2000);
            } else {
              showMessage('ÂØºÂÖ•Â§±Ë¥•: ' + (result.error || 'Êú™Áü•ÈîôËØØ'), 'error');
            }
          } catch (error) {
            showMessage('ÂØºÂÖ•Â§±Ë¥•: ' + error.message, 'error');
          } finally {
            input.value = '';
          }
        }
        
        // ‰øùÂ≠òÊï∞ÊçÆÂà∞ÊúçÂä°Âô®
        async function saveToServer(type) {
          if (isLoading) return;
          
          try {
            showMessage('‰øùÂ≠ò‰∏≠...', 'info', 0);
            isLoading = true;
            
            const response = await fetch('/api/save', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ type, data: currentData })
            });
            
            const result = await response.json();
            
            if (result.success) {
              showMessage('‰øùÂ≠òÊàêÂäü', 'success');
              document.getElementById('last-updated').textContent = new Date().toLocaleString('zh-CN');
            } else {
              showMessage('‰øùÂ≠òÂ§±Ë¥•: ' + (result.error || 'Êú™Áü•ÈîôËØØ'), 'error');
            }
          } catch (error) {
            showMessage('‰øùÂ≠òÂ§±Ë¥•: ' + error.message, 'error');
          } finally {
            isLoading = false;
          }
        }
        
        // ÁôªÂá∫
        function logout() {
          if (confirm('Á°ÆÂÆöË¶ÅÈÄÄÂá∫ÁôªÂΩïÂêóÔºü')) {
            window.location.href = '/logout';
          }
        }
        
        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', () => {
          // ËÆæÁΩÆËÉåÊôØÂõæÁâáÈ¢ÑËßà
          const bgImageInput = document.getElementById('bg-image');
          if (bgImageInput) {
            bgImageInput.addEventListener('input', function() {
              const previewEl = document.querySelector('.bg-preview');
              const imgEl = previewEl.querySelector('img') || document.getElementById('bg-preview-img');
              
              if (this.value) {
                imgEl.src = this.value;
                previewEl.style.display = 'flex';
              } else {
                previewEl.style.display = 'none';
              }
            });
          }
          
          // ÊãñÊîæ‰∏ä‰º†
          const uploadArea = document.querySelector('.upload-area');
          if (uploadArea) {
            uploadArea.addEventListener('dragover', (e) => {
              e.preventDefault();
              uploadArea.style.borderColor = '#667eea';
              uploadArea.style.background = '#f8fafc';
            });
            
            uploadArea.addEventListener('dragleave', () => {
              uploadArea.style.borderColor = '#cbd5e0';
              uploadArea.style.background = '';
            });
            
            uploadArea.addEventListener('drop', (e) => {
              e.preventDefault();
              uploadArea.style.borderColor = '#cbd5e0';
              uploadArea.style.background = '';
              
              const files = e.dataTransfer.files;
              if (files.length > 0) {
                const input = document.getElementById('bg-upload');
                input.files = files;
                uploadBackgroundImage(input);
              }
            });
          }
        });
      </script>
    </body>
    </html>
  `;
}

/**
 * ÁîüÊàêÈîôËØØÈ°µÈù¢
 */
export function generateErrorPage(message, status = 500) {
  return `
    <!DOCTYPE html>
    <html lang="zh-CN">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>${status} ÈîôËØØ</title>
      <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          height: 100vh;
          display: flex;
          justify-content: center;
          align-items: center;
          text-align: center;
          color: white;
          padding: 20px;
        }
        .error-container {
          background: rgba(255, 255, 255, 0.1);
          backdrop-filter: blur(10px);
          padding: 50px 40px;
          border-radius: 20px;
          box-shadow: 0 20px 60px rgba(0,0,0,0.2);
          max-width: 500px;
          width: 100%;
        }
        h1 {
          font-size: 6rem;
          font-weight: 700;
          margin-bottom: 20px;
          text-shadow: 3px 3px 0 rgba(0,0,0,0.1);
        }
        h2 {
          font-size: 1.8rem;
          margin-bottom: 20px;
          font-weight: 500;
        }
        p {
          font-size: 1.1rem;
          margin-bottom: 30px;
          opacity: 0.9;
          line-height: 1.6;
        }
        .home-link {
          display: inline-block;
          background: white;
          color: #667eea;
          padding: 14px 30px;
          border-radius: 50px;
          text-decoration: none;
          font-weight: 600;
          transition: transform 0.2s, box-shadow 0.2s;
        }
        .home-link:hover {
          transform: translateY(-2px);
          box-shadow: 0 10px 25px rgba(255,255,255,0.3);
        }
        @media (max-width: 480px) {
          h1 { font-size: 4rem; }
          .error-container { padding: 40px 20px; }
        }
      </style>
    </head>
    <body>
      <div class="error-container">
        <h1>${status}</h1>
        <h2>${getErrorMessage(status)}</h2>
        <p>${message}</p>
        <a href="/" class="home-link">ËøîÂõûÈ¶ñÈ°µ</a>
      </div>
    </body>
    </html>
  `;
}

/**
 * Ëé∑ÂèñÈîôËØØÊ∂àÊÅØ
 */
function getErrorMessage(status) {
  const messages = {
    400: 'ËØ∑Ê±ÇÈîôËØØ',
    401: 'Êú™ÁªèÊéàÊùÉ',
    403: 'Á¶ÅÊ≠¢ËÆøÈóÆ',
    404: 'È°µÈù¢Êú™ÊâæÂà∞',
    500: 'ÊúçÂä°Âô®ÂÜÖÈÉ®ÈîôËØØ',
    503: 'ÊúçÂä°ÊöÇÊó∂‰∏çÂèØÁî®'
  };
  return messages[status] || 'ÂèëÁîüÈîôËØØ';
}
```

---

## 10. `src/utils.js` - Â∑•ÂÖ∑ÂáΩÊï∞

```javascript
/**
 * Â∑•ÂÖ∑ÂáΩÊï∞Ê®°Âùó
 */

/**
 * ÁîüÊàêÈîôËØØÂìçÂ∫î
 */
export function errorResponse(message, status = 500) {
  return new Response(JSON.stringify({
    success: false,
    error: message,
    timestamp: new Date().toISOString()
  }), {
    status,
    headers: { 'Content-Type': 'application/json' }
  });
}

/**
 * ÁîüÊàêÊàêÂäüÂìçÂ∫î
 */
export function successResponse(data = {}, message = '') {
  return new Response(JSON.stringify({
    success: true,
    data,
    message,
    timestamp: new Date().toISOString()
  }), {
    headers: { 'Content-Type': 'application/json' }
  });
}

/**
 * È™åËØÅ URL Ê†ºÂºè
 */
export function isValidUrl(url) {
  try {
    new URL(url);
    return true;
  } catch {
    return false;
  }
}

/**
 * ÁîüÊàêÁΩëÁ´ôÂõæÊ†á
 */
export function generateSiteIcon(name) {
  // ‰ªéÂêçÁß∞ÁîüÊàêÁÆÄÂçïÂõæÊ†á
  const colors = [
    '#667eea', '#764ba2', '#f56565', '#ed8936',
    '#ecc94b', '#48bb78', '#38b2ac', '#4299e1'
  ];
  
  const color = colors[name.charCodeAt(0) % colors.length];
  const letter = name.charAt(0).toUpperCase();
  
  return { color, letter };
}

/**
 * Ê†ºÂºèÂåñÊñá‰ª∂Â§ßÂ∞è
 */
export function formatFileSize(bytes) {
  if (bytes === 0) return '0 Bytes';
  
  const k = 1024;
  const sizes = ['Bytes', 'KB', 'MB', 'GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

/**
 * ÁîüÊàêÈöèÊú∫ ID
 */
export function generateId() {
  return Date.now().toString(36) + Math.random().toString(36).substr(2);
}

/**
 * Ê∑±Â∫¶ÂÖãÈöÜÂØπË±°
 */
export function deepClone(obj) {
  return JSON.parse(JSON.stringify(obj));
}

/**
 * È™åËØÅÁîµÂ≠êÈÇÆ‰ª∂Ê†ºÂºè
 */
export function isValidEmail(email) {
  const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return re.test(email);
}

/**
 * Èò≤ÊäñÂáΩÊï∞
 */
export function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}

/**
 * ËäÇÊµÅÂáΩÊï∞
 */
export function throttle(func, limit) {
  let inThrottle;
  return function executedFunction(...args) {
    if (!inThrottle) {
      func(...args);
      inThrottle = true;
      setTimeout(() => (inThrottle = false), limit);
    }
  };
}

/**
 * ÂÆâÂÖ® HTML ËΩ¨‰πâ
 */
export function escapeHtml(text) {
  const map = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#039;'
  };
  return text.replace(/[&<>"']/g, m => map[m]);
}

/**
 * ÁîüÊàêÈ¢úËâ≤Ê¢ØÂ∫¶
 */
export function generateGradient(color1, color2, steps) {
  const gradients = [];
  const stepFactor = 1 / (steps - 1);
  
  for (let i = 0; i < steps; i++) {
    const r = Math.round(
      parseInt(color1.slice(1, 3), 16) * (1 - stepFactor * i) +
      parseInt(color2.slice(1, 3), 16) * stepFactor * i
    );
    const g = Math.round(
      parseInt(color1.slice(3, 5), 16) * (1 - stepFactor * i) +
      parseInt(color2.slice(3, 5), 16) * stepFactor * i
    );
    const b = Math.round(
      parseInt(color1.slice(5, 7), 16) * (1 - stepFactor * i) +
      parseInt(color2.slice(5, 7), 16) * stepFactor * i
    );
    
    gradients.push(`#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`);
  }
  
  return gradients;
}

/**
 * Ê£ÄÊµãÁßªÂä®ËÆæÂ§á
 */
export function isMobileDevice(userAgent) {
  return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
}

/**
 * Ê†ºÂºèÂåñÊó•Êúü
 */
export function formatDate(date, format = 'yyyy-MM-dd HH:mm:ss') {
  const d = new Date(date);
  const pad = n => n.toString().padStart(2, '0');
  
  const replacements = {
    'yyyy': d.getFullYear(),
    'MM': pad(d.getMonth() + 1),
    'dd': pad(d.getDate()),
    'HH': pad(d.getHours()),
    'mm': pad(d.getMinutes()),
    'ss': pad(d.getSeconds())
  };
  
  return format.replace(/yyyy|MM|dd|HH|mm|ss/g, match => replacements[match]);
}

/**
 * Ëß£ÊûêÊü•ËØ¢ÂèÇÊï∞
 */
export function parseQueryParams(url) {
  const params = {};
  const searchParams = new URL(url).searchParams;
  
  for (const [key, value] of searchParams.entries()) {
    params[key] = value;
  }
  
  return params;
}
```

---

## 11. `docs/deployment.md` - ÈÉ®ÁΩ≤ÊåáÂçó

```markdown
# ÈÉ®ÁΩ≤ÊåáÂçó

## ÁéØÂ¢ÉË¶ÅÊ±Ç

- Node.js 16.0 ÊàñÊõ¥È´òÁâàÊú¨
- npm Êàñ yarn
- Cloudflare Ë¥¶Êà∑
- Wrangler CLI

## Ê≠•È™§ 1: ÂÆâË£Ö‰æùËµñ

```bash
# ÂÖãÈöÜÈ°πÁõÆ
git clone https://github.com/yourusername/dao-hang.git
cd dao-hang

# ÂÆâË£Ö‰æùËµñ
npm install

# ÂÆâË£Ö Wrangler CLIÔºàÂ¶ÇÊûúÂ∞öÊú™ÂÆâË£ÖÔºâ
npm install -g wrangler
```

## Ê≠•È™§ 2: ÈÖçÁΩÆ Cloudflare

### 2.1 ÁôªÂΩï Cloudflare

```bash
# ÁôªÂΩïÂà∞ Cloudflare
wrangler login
```

### 2.2 ÂàõÂª∫ KV ÂëΩÂêçÁ©∫Èó¥

```bash
# ÂàõÂª∫Áîü‰∫ßÁéØÂ¢É KV ÂëΩÂêçÁ©∫Èó¥
wrangler kv:namespace create "NAV_STORE"

# ÂàõÂª∫È¢ÑËßàÁéØÂ¢É KV ÂëΩÂêçÁ©∫Èó¥
wrangler kv:namespace create "NAV_STORE" --preview
```

‰øùÂ≠òËøîÂõûÁöÑÂëΩÂêçÁ©∫Èó¥ IDÔºåÁ®çÂêéÈúÄË¶ÅÂú® `wrangler.toml` ‰∏≠ÈÖçÁΩÆ„ÄÇ

### 2.3 ÂàõÂª∫ R2 Â≠òÂÇ®Ê°∂ÔºàÂèØÈÄâÔºåÁî®‰∫éÊñá‰ª∂‰∏ä‰º†Ôºâ

```bash
# ÂàõÂª∫ R2 Â≠òÂÇ®Ê°∂
wrangler r2 bucket create dao-hang-uploads

# ÂàõÂª∫È¢ÑËßàÂ≠òÂÇ®Ê°∂
wrangler r2 bucket create dao-hang-uploads-preview
```

## Ê≠•È™§ 3: ÈÖçÁΩÆÈ°πÁõÆ

### 3.1 Â§çÂà∂ÁéØÂ¢ÉÂèòÈáèÊñá‰ª∂

```bash
cp .env.example .env
```

### 3.2 ÁºñËæëÁéØÂ¢ÉÂèòÈáè

ÁºñËæë `.env` Êñá‰ª∂ÔºåËÆæÁΩÆ‰ª•‰∏ãÂèòÈáèÔºö

```env
# Cloudflare Ë¥¶Êà∑ÈÖçÁΩÆ
CLOUDFLARE_ACCOUNT_ID=your_account_id_here
CLOUDFLARE_API_TOKEN=your_api_token_here

# ÁÆ°ÁêÜÂëòËÆ§ËØÅ
ADMIN_USERNAME=admin
ADMIN_PASSWORD=your_secure_password_here

# KV ÂëΩÂêçÁ©∫Èó¥
KV_NAMESPACE_ID=your_kv_namespace_id
KV_PREVIEW_NAMESPACE_ID=your_preview_kv_id
```

### 3.3 ÈÖçÁΩÆ `wrangler.toml`

ÁºñËæë `wrangler.toml` Êñá‰ª∂ÔºåÊõ¥Êñ∞‰ª•‰∏ãÈÖçÁΩÆÔºö

1. ÊõøÊç¢ KV ÂëΩÂêçÁ©∫Èó¥ ID
2. ËÆæÁΩÆÁÆ°ÁêÜÂëòÁî®Êà∑ÂêçÂíåÂØÜÁ†Å
3. ÈÖçÁΩÆËá™ÂÆö‰πâÂüüÂêçÔºàÂèØÈÄâÔºâ

## Ê≠•È™§ 4: Êú¨Âú∞ÂºÄÂèë

```bash
# ÂêØÂä®Êú¨Âú∞ÂºÄÂèëÊúçÂä°Âô®
npm run dev

# ËÆøÈóÆ http://localhost:8787
```

## Ê≠•È™§ 5: ÈÉ®ÁΩ≤Âà∞ Cloudflare

### 5.1 ÈÉ®ÁΩ≤Âà∞È¢ÑËßàÁéØÂ¢É

```bash
# ÈÉ®ÁΩ≤Âà∞È¢ÑËßàÁéØÂ¢É
npm run deploy:preview

# ÊàñËÄÖ‰ΩøÁî®
wrangler deploy --env preview
```

### 5.2 ÈÉ®ÁΩ≤Âà∞Áîü‰∫ßÁéØÂ¢É

```bash
# ÈÉ®ÁΩ≤Âà∞Áîü‰∫ßÁéØÂ¢É
npm run deploy

# ÊàñËÄÖ‰ΩøÁî®
wrangler deploy
```

## Ê≠•È™§ 6: ÁªëÂÆöËá™ÂÆö‰πâÂüüÂêçÔºàÂèØÈÄâÔºâ

### 6.1 Ê∑ªÂä†Ë∑ØÁî±

Âú® `wrangler.toml` ‰∏≠ÈÖçÁΩÆË∑ØÁî±Ôºö

```toml
[env.production.route]
pattern = "dao-hang.yourdomain.com/*"
zone_id = "your_zone_id"
```

### 6.2 Âú® Cloudflare Dashboard ‰∏≠ÈÖçÁΩÆ

1. ÁôªÂΩï Cloudflare Dashboard
2. ËøõÂÖ•‰Ω†ÁöÑÂüüÂêç
3. ËΩ¨Âà∞ Workers & Pages
4. Ê∑ªÂä†Ë∑ØÁî±

## Ê≠•È™§ 7: ÊµãËØïÈÉ®ÁΩ≤

### 7.1 ÊµãËØï‰∏ªÈ°µ

ËÆøÈóÆ‰Ω†ÁöÑ Workers URL ÊàñËá™ÂÆö‰πâÂüüÂêçÔºö
```
https://dao-hang.yourusername.workers.dev
```

### 7.2 ÊµãËØïÁÆ°ÁêÜÂêéÂè∞

ËÆøÈóÆÁÆ°ÁêÜÂêéÂè∞Âπ∂ÁôªÂΩïÔºö
```
https://dao-hang.yourusername.workers.dev/admin
```

‰ΩøÁî®ÈÖçÁΩÆÁöÑÁî®Êà∑ÂêçÂíåÂØÜÁ†ÅÁôªÂΩï„ÄÇ

## ÊïÖÈöúÊéíÈô§

### Â∏∏ËßÅÈóÆÈ¢ò 1: KV ÂëΩÂêçÁ©∫Èó¥ÈîôËØØ

```
‚úò [ERROR] Could not find KV namespace with id "xxx"
```

Ëß£ÂÜ≥ÊñπÊ°àÔºö
1. Á°ÆËÆ§ KV ÂëΩÂêçÁ©∫Èó¥ ID Ê≠£Á°Æ
2. Á°Æ‰øù KV ÂëΩÂêçÁ©∫Èó¥‰∏é Worker Âú®Âêå‰∏Ä‰∏™Ë¥¶Êà∑‰∏≠

### Â∏∏ËßÅÈóÆÈ¢ò 2: ÊùÉÈôêÈîôËØØ

```
‚úò [ERROR] Authentication error
```

Ëß£ÂÜ≥ÊñπÊ°àÔºö
1. ËøêË°å `wrangler login` ÈáçÊñ∞ÁôªÂΩï
2. Ê£ÄÊü• API Token ÊùÉÈôê

### Â∏∏ËßÅÈóÆÈ¢ò 3: CORS ÈîôËØØ

Â¶ÇÊûú‰ªéËá™ÂÆö‰πâÂüüÂêçËÆøÈóÆÊó∂Âá∫Áé∞ CORS ÈîôËØØÔºö

1. Âú® Cloudflare Dashboard ‰∏≠ÈÖçÁΩÆ CORS ËßÑÂàô
2. ÊàñËÄÖÂú® Worker ‰ª£Á†Å‰∏≠Ê∑ªÂä† CORS Â§¥

### Â∏∏ËßÅÈóÆÈ¢ò 4: ÈùôÊÄÅÊñá‰ª∂Êó†Ê≥ïËÆøÈóÆ

Â¶ÇÊûúÈùôÊÄÅÊñá‰ª∂Êó†Ê≥ïËÆøÈóÆÔºö

1. Á°Æ‰øù R2 Â≠òÂÇ®Ê°∂Â∑≤Ê≠£Á°ÆÈÖçÁΩÆ
2. Ê£ÄÊü•Êñá‰ª∂‰∏ä‰º†ÊùÉÈôê
3. È™åËØÅÊñá‰ª∂Ë∑ØÂæÑ

## Áª¥Êä§ÂíåÊõ¥Êñ∞

### Â§á‰ªΩÊï∞ÊçÆ

```bash
# ÂàõÂª∫Êï∞ÊçÆÂ§á‰ªΩ
npm run backup

# Êï∞ÊçÆ‰ºö‰øùÂ≠òÂú® KV ‰∏≠Ôºå‰πüÂèØ‰ª•ÈÄöËøáÁÆ°ÁêÜÂêéÂè∞‰∏ãËΩΩ
```

### Êõ¥Êñ∞‰ª£Á†Å

```bash
# ÊãâÂèñÊúÄÊñ∞‰ª£Á†Å
git pull origin main

# ÈáçÊñ∞ÈÉ®ÁΩ≤
npm run deploy
```

### ÁõëÊéßÊó•Âøó

```bash
# Êü•ÁúãÂÆûÊó∂Êó•Âøó
wrangler tail

# Á≠õÈÄâÈîôËØØÊó•Âøó
wrangler tail --format json | grep error
```

## ÂÆâÂÖ®Âª∫ËÆÆ

1. **ÂÆöÊúüÊõ¥ÊîπÂØÜÁ†Å**ÔºöÂÆöÊúüÊõ¥Êñ∞ÁÆ°ÁêÜÂëòÂØÜÁ†Å
2. **ÂêØÁî® HTTPS**ÔºöÁ°Æ‰øùÈÄöËøá HTTPS ËÆøÈóÆ
3. **ÈôêÂà∂ËÆøÈóÆ**ÔºöÂ¶ÇÊúâÈúÄË¶ÅÔºåÂèØÈÖçÁΩÆ IP ÁôΩÂêçÂçï
4. **ÂÆöÊúüÂ§á‰ªΩ**ÔºöÂÆöÊúüÂ§á‰ªΩÂØºËà™Êï∞ÊçÆ
5. **ÁõëÊéß‰ΩøÁî®ÊÉÖÂÜµ**ÔºöÂÖ≥Ê≥® Cloudflare Workers ‰ΩøÁî®Èáè

## ÊÄßËÉΩ‰ºòÂåñ

1. **ÂêØÁî®ÁºìÂ≠ò**ÔºöÈùôÊÄÅËµÑÊ∫êÂèØÈÖçÁΩÆÁºìÂ≠ò
2. **‰ºòÂåñÂõæÁâá**ÔºöËÉåÊôØÂõæÁâáÂª∫ËÆÆÂéãÁº©
3. **ÂáèÂ∞ë KV ËØªÂèñ**ÔºöÂêàÁêÜ‰ΩøÁî®ÁºìÂ≠ò
4. **CDN Âä†ÈÄü**Ôºö‰ΩøÁî® Cloudflare CDN

## Êâ©Â±ïÈÉ®ÁΩ≤

### Â§öÁéØÂ¢ÉÈÉ®ÁΩ≤

- **ÂºÄÂèëÁéØÂ¢É**ÔºöÊú¨Âú∞ÂºÄÂèë
- **È¢ÑËßàÁéØÂ¢É**ÔºöÁî®‰∫éÊµãËØï
- **Áîü‰∫ßÁéØÂ¢É**ÔºöÊ≠£Âºè‰ΩøÁî®

### Âå∫ÂüüÈÉ®ÁΩ≤

ÂèØÈÖçÁΩÆÂú®‰∏çÂêåÂå∫ÂüüÈÉ®ÁΩ≤ Worker ‰ª•ÂÆûÁé∞Âú∞ÁêÜ‰ºòÂåñÔºö

```toml
[env.production]
zone_id = "your_zone_id"
routes = [
  { pattern = "dao-hang.us.example.com/*", zone_id = "us_zone_id" },
  { pattern = "dao-hang.eu.example.com/*", zone_id = "eu_zone_id" }
]
```

## ËÅîÁ≥ªÊîØÊåÅ

Â¶ÇÈÅáÈóÆÈ¢òÔºåÂèØÈÄöËøá‰ª•‰∏ãÊñπÂºèÂØªÊ±ÇÂ∏ÆÂä©Ôºö

1. Êü•Áúã [GitHub Issues](https://github.com/yourusername/dao-hang/issues)
2. Êü•ÈòÖ [Cloudflare Workers ÊñáÊ°£](https://developers.cloudflare.com/workers/)
3. ËÅîÁ≥ªÈ°πÁõÆÁª¥Êä§ËÄÖ
```

---

## 12. `scripts/deploy.sh` - ÈÉ®ÁΩ≤ËÑöÊú¨

```bash
#!/bin/bash

# Dao-Hang ÈÉ®ÁΩ≤ËÑöÊú¨
# ‰ΩúËÄÖ: Your Name
# ÁâàÊú¨: 1.0.0

set -e  # ÈÅáÂà∞ÈîôËØØÊó∂ÈÄÄÂá∫ËÑöÊú¨

# È¢úËâ≤ÂÆö‰πâ
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Êó•ÂøóÂáΩÊï∞
log_info() {
    echo -e "${BLUE}[INFO]${NC} $1"
}

log_success() {
    echo -e "${GREEN}[SUCCESS]${NC} $1"
}

log_warning() {
    echo -e "${YELLOW}[WARNING]${NC} $1"
}

log_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

# Ê£ÄÊü•ÂëΩ‰ª§ÊòØÂê¶Â≠òÂú®
check_command() {
    if ! command -v $1 &> /dev/null; then
        log_error "$1 Êú™ÂÆâË£ÖÔºåËØ∑ÂÖàÂÆâË£Ö $1"
        exit 1
    fi
}

# ÊòæÁ§∫Â∏ÆÂä©
show_help() {
    echo "Dao-Hang ÈÉ®ÁΩ≤ËÑöÊú¨"
    echo ""
    echo "Áî®Ê≥ï: ./deploy.sh [ÈÄâÈ°π]"
    echo ""
    echo "ÈÄâÈ°π:"
    echo "  -h, --help          ÊòæÁ§∫Â∏ÆÂä©‰ø°ÊÅØ"
    echo "  -d, --dev           ÈÉ®ÁΩ≤Âà∞ÂºÄÂèëÁéØÂ¢É"
    echo "  -p, --preview       ÈÉ®ÁΩ≤Âà∞È¢ÑËßàÁéØÂ¢É"
    echo "  -P, --production    ÈÉ®ÁΩ≤Âà∞Áîü‰∫ßÁéØÂ¢É"
    echo "  -t, --test          ËøêË°åÊµãËØï"
    echo "  -b, --backup        ÂàõÂª∫Êï∞ÊçÆÂ§á‰ªΩ"
    echo "  -c, --clean         Ê∏ÖÁêÜÊûÑÂª∫ÁºìÂ≠ò"
    echo "  -l, --logs          Êü•ÁúãÊó•Âøó"
    echo "  -s, --status        Êü•ÁúãÈÉ®ÁΩ≤Áä∂ÊÄÅ"
    echo ""
}

# Ê£ÄÊü•ÁéØÂ¢É
check_environment() {
    log_info "Ê£ÄÊü•ÁéØÂ¢É..."
    
    # Ê£ÄÊü•ÂøÖË¶ÅÂëΩ‰ª§
    check_command node
    check_command npm
    check_command wrangler
    
    # Ê£ÄÊü• Node.js ÁâàÊú¨
    NODE_VERSION=$(node -v | cut -d'v' -f2)
    REQUIRED_VERSION="16.0.0"
    
    if [ "$(printf '%s\n' "$REQUIRED_VERSION" "$NODE_VERSION" | sort -V | head -n1)" != "$REQUIRED_VERSION" ]; then
        log_error "Node.js ÁâàÊú¨ÈúÄË¶Å >= $REQUIRED_VERSIONÔºåÂΩìÂâçÁâàÊú¨: $NODE_VERSION"
        exit 1
    fi
    
    log_success "ÁéØÂ¢ÉÊ£ÄÊü•ÈÄöËøá"
}

# ÂÆâË£Ö‰æùËµñ
install_dependencies() {
    log_info "ÂÆâË£Ö‰æùËµñ..."
    
    if [ ! -d "node_modules" ]; then
        npm install
    else
        npm ci
    fi
    
    log_success "‰æùËµñÂÆâË£ÖÂÆåÊàê"
}

# ËøêË°åÊµãËØï
run_tests() {
    log_info "ËøêË°åÊµãËØï..."
    
    if npm test; then
        log_success "ÊµãËØïÈÄöËøá"
    else
        log_error "ÊµãËØïÂ§±Ë¥•"
        exit 1
    fi
}

# ‰ª£Á†ÅÊ£ÄÊü•
run_lint() {
    log_info "ËøêË°å‰ª£Á†ÅÊ£ÄÊü•..."
    
    if npm run lint; then
        log_success "‰ª£Á†ÅÊ£ÄÊü•ÈÄöËøá"
    else
        log_warning "‰ª£Á†ÅÊ£ÄÊü•ÂèëÁé∞‰∏Ä‰∫õÈóÆÈ¢ò"
    fi
}

# Ê†ºÂºèÂåñ‰ª£Á†Å
run_format() {
    log_info "Ê†ºÂºèÂåñ‰ª£Á†Å..."
    npm run format
    log_success "‰ª£Á†ÅÊ†ºÂºèÂåñÂÆåÊàê"
}

# Ê∏ÖÁêÜÊûÑÂª∫ÁºìÂ≠ò
clean_build() {
    log_info "Ê∏ÖÁêÜÊûÑÂª∫ÁºìÂ≠ò..."
    
    # Ê∏ÖÁêÜ node_modules
    if [ "$1" = "full" ]; then
        rm -rf node_modules
        log_info "Â∑≤Âà†Èô§ node_modules"
    fi
    
    # Ê∏ÖÁêÜ Wrangler ÁºìÂ≠ò
    rm -rf .wrangler
    
    # Ê∏ÖÁêÜÂÖ∂‰ªñÁºìÂ≠òÊñá‰ª∂
    rm -rf dist build coverage
    
    log_success "Ê∏ÖÁêÜÂÆåÊàê"
}

# ÈÉ®ÁΩ≤Âà∞ÂºÄÂèëÁéØÂ¢É
deploy_dev() {
    log_info "ÈÉ®ÁΩ≤Âà∞ÂºÄÂèëÁéØÂ¢É..."
    
    # Ê£ÄÊü•ÁéØÂ¢ÉÂèòÈáè
    if [ ! -f ".env" ]; then
        log_error ".env Êñá‰ª∂‰∏çÂ≠òÂú®ÔºåËØ∑ÂÖàÂ§çÂà∂ .env.example Âπ∂ÈÖçÁΩÆ"
        exit 1
    fi
    
    # ÂêØÂä®ÂºÄÂèëÊúçÂä°Âô®
    wrangler dev
    
    log_success "ÂºÄÂèëÊúçÂä°Âô®Â∑≤ÂêØÂä®"
}

# ÈÉ®ÁΩ≤Âà∞È¢ÑËßàÁéØÂ¢É
deploy_preview() {
    log_info "ÈÉ®ÁΩ≤Âà∞È¢ÑËßàÁéØÂ¢É..."
    
    # ËøêË°åÊµãËØïÂíåÊ£ÄÊü•
    run_tests
    run_lint
    
    # ÈÉ®ÁΩ≤Âà∞È¢ÑËßàÁéØÂ¢É
    if wrangler deploy --env preview; then
        log_success "È¢ÑËßàÁéØÂ¢ÉÈÉ®ÁΩ≤ÊàêÂäü"
        
        # Ëé∑ÂèñÈÉ®ÁΩ≤ URL
        DEPLOY_URL=$(wrangler whoami | grep -o 'https://.*\.workers\.dev' || echo "Êú™Áü•")
        log_info "È¢ÑËßàÁéØÂ¢É URL: $DEPLOY_URL"
    else
        log_error "È¢ÑËßàÁéØÂ¢ÉÈÉ®ÁΩ≤Â§±Ë¥•"
        exit 1
    fi
}

# ÈÉ®ÁΩ≤Âà∞Áîü‰∫ßÁéØÂ¢É
deploy_production() {
    log_info "ÈÉ®ÁΩ≤Âà∞Áîü‰∫ßÁéØÂ¢É..."
    
    # Á°ÆËÆ§ÈÉ®ÁΩ≤
    echo -e "${YELLOW}Âç≥Â∞ÜÈÉ®ÁΩ≤Âà∞Áîü‰∫ßÁéØÂ¢ÉÔºåËØ∑Á°ÆËÆ§Ôºö${NC}"
    echo "1. Â∑≤ËøêË°åÊâÄÊúâÊµãËØï"
    echo "2. ‰ª£Á†ÅÂ∑≤Êèê‰∫§Âà∞ Git"
    echo "3. Â∑≤Â§á‰ªΩÂΩìÂâçÊï∞ÊçÆ"
    echo ""
    read -p "ÊòØÂê¶ÁªßÁª≠Ôºü(y/N): " -n 1 -r
    echo ""
    
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        log_info "ÂèñÊ∂àÈÉ®ÁΩ≤"
        exit 0
    fi
    
    # ËøêË°åÊµãËØïÂíåÊ£ÄÊü•
    run_tests
    run_lint
    
    # ÂàõÂª∫Â§á‰ªΩ
    create_backup "pre_deploy_$(date +%Y%m%d_%H%M%S)"
    
    # ÈÉ®ÁΩ≤Âà∞Áîü‰∫ßÁéØÂ¢É
    if wrangler deploy; then
        log_success "Áîü‰∫ßÁéØÂ¢ÉÈÉ®ÁΩ≤ÊàêÂäü"
        
        # Ëé∑ÂèñÈÉ®ÁΩ≤ URL
        DEPLOY_URL=$(wrangler whoami | grep -o 'https://.*\.workers\.dev' || echo "Êú™Áü•")
        log_info "Áîü‰∫ßÁéØÂ¢É URL: $DEPLOY_URL"
        
        # ËøêË°åÂÅ•Â∫∑Ê£ÄÊü•
        health_check $DEPLOY_URL
    else
        log_error "Áîü‰∫ßÁéØÂ¢ÉÈÉ®ÁΩ≤Â§±Ë¥•"
        exit 1
    fi
}

# ÂàõÂª∫Êï∞ÊçÆÂ§á‰ªΩ
create_backup() {
    local backup_name=${1:-"manual_backup_$(date +%Y%m%d_%H%M%S)"}
    
    log_info "ÂàõÂª∫Êï∞ÊçÆÂ§á‰ªΩ: $backup_name"
    
    # ÈÄöËøá API ÂàõÂª∫Â§á‰ªΩ
    if curl -s -X POST "$BACKUP_URL" > /dev/null 2>&1; then
        log_success "Â§á‰ªΩÂàõÂª∫ÊàêÂäü: $backup_name"
    else
        log_warning "Êó†Ê≥ïÈÄöËøá API ÂàõÂª∫Â§á‰ªΩÔºåÂ∞ùËØïÂÖ∂‰ªñÊñπÂºè"
        
        # Â∞ùËØïÁõ¥Êé•Â§á‰ªΩ KV Êï∞ÊçÆ
        if command -v wrangler &> /dev/null; then
            wrangler kv:key get --binding NAV_STORE "nav_data" > "backup_${backup_name}.json" 2>/dev/null && \
            log_success "KV Êï∞ÊçÆÂ§á‰ªΩÊàêÂäü: backup_${backup_name}.json" || \
            log_error "KV Êï∞ÊçÆÂ§á‰ªΩÂ§±Ë¥•"
        fi
    fi
}

# Êü•ÁúãÊó•Âøó
view_logs() {
    log_info "Êü•ÁúãÊúÄËøëÊó•Âøó..."
    
    # Êü•Áúã Wrangler Êó•Âøó
    wrangler tail --format pretty
    
    # ‰πüÂèØ‰ª•Êü•ÁúãÊñá‰ª∂Êó•Âøó
    if [ -f "logs/deploy.log" ]; then
        echo ""
        echo "ÊúÄËøëÈÉ®ÁΩ≤Êó•Âøó:"
        tail -20 logs/deploy.log
    fi
}

# ÂÅ•Â∫∑Ê£ÄÊü•
health_check() {
    local url=$1
    
    log_info "ÊâßË°åÂÅ•Â∫∑Ê£ÄÊü•..."
    
    # Ê£ÄÊü•‰∏ªÈ°µ
    if curl -s -f "$url" > /dev/null; then
        log_success "‰∏ªÈ°µËÆøÈóÆÊ≠£Â∏∏"
    else
        log_error "‰∏ªÈ°µËÆøÈóÆÂ§±Ë¥•"
        return 1
    fi
    
    # Ê£ÄÊü• API
    if curl -s -f "$url/api/health" > /dev/null; then
        log_success "API ËÆøÈóÆÊ≠£Â∏∏"
    else
        log_warning "API ËÆøÈóÆÂ§±Ë¥•ÔºàÂèØËÉΩÊú™ÂÆûÁé∞Ôºâ"
    fi
    
    # Ê£ÄÊü•ÁÆ°ÁêÜÂêéÂè∞ÁôªÂΩïÈ°µ
    if curl -s -f "$url/login" > /dev/null; then
        log_success "ÁôªÂΩïÈ°µËÆøÈóÆÊ≠£Â∏∏"
    else
        log_error "ÁôªÂΩïÈ°µËÆøÈóÆÂ§±Ë¥•"
        return 1
    fi
    
    log_success "ÂÅ•Â∫∑Ê£ÄÊü•ÈÄöËøá"
}

# Êü•ÁúãÈÉ®ÁΩ≤Áä∂ÊÄÅ
check_status() {
    log_info "Ê£ÄÊü•ÈÉ®ÁΩ≤Áä∂ÊÄÅ..."
    
    # Ê£ÄÊü• Wrangler ÁôªÂΩïÁä∂ÊÄÅ
    if wrangler whoami > /dev/null 2>&1; then
        log_success "Wrangler Â∑≤ÁôªÂΩï"
    else
        log_error "Wrangler Êú™ÁôªÂΩïÔºåËØ∑ËøêË°å: wrangler login"
    fi
    
    # Ê£ÄÊü• KV ÂëΩÂêçÁ©∫Èó¥
    if wrangler kv:namespace list | grep -q "NAV_STORE"; then
        log_success "KV ÂëΩÂêçÁ©∫Èó¥Â∑≤ÈÖçÁΩÆ"
    else
        log_error "KV ÂëΩÂêçÁ©∫Èó¥Êú™ÊâæÂà∞"
    fi
    
    # Ê£ÄÊü• R2 Â≠òÂÇ®Ê°∂ÔºàÂ¶ÇÊûúÈÖçÁΩÆ‰∫ÜÔºâ
    if wrangler r2 bucket list | grep -q "dao-hang-uploads"; then
        log_success "R2 Â≠òÂÇ®Ê°∂Â∑≤ÈÖçÁΩÆ"
    else
        log_warning "R2 Â≠òÂÇ®Ê°∂Êú™ÈÖçÁΩÆÔºàÊñá‰ª∂‰∏ä‰º†ÂäüËÉΩÂèØËÉΩÂèóÈôêÔºâ"
    fi
    
    # Ê£ÄÊü•ÁéØÂ¢ÉÂèòÈáèÊñá‰ª∂
    if [ -f ".env" ]; then
        log_success ".env Êñá‰ª∂Â≠òÂú®"
    else
        log_error ".env Êñá‰ª∂‰∏çÂ≠òÂú®"
    fi
    
    # Ê£ÄÊü•ÊúÄËøëÈÉ®ÁΩ≤
    log_info "ÊúÄËøëÈÉ®ÁΩ≤:"
    wrangler deployments list --limit 3 2>/dev/null || log_warning "Êó†Ê≥ïËé∑ÂèñÈÉ®ÁΩ≤ÂàóË°®"
}

# Â§á‰ªΩÊÅ¢Â§ç
restore_backup() {
    local backup_id=$1
    
    if [ -z "$backup_id" ]; then
        log_error "ËØ∑ÊåáÂÆöÂ§á‰ªΩ ID"
        exit 1
    fi
    
    log_info "ÊÅ¢Â§çÂ§á‰ªΩ: $backup_id"
    
    # Á°ÆËÆ§ÊÅ¢Â§ç
    echo -e "${YELLOW}Ë≠¶ÂëäÔºöËøôÂ∞ÜË¶ÜÁõñÂΩìÂâçÊï∞ÊçÆÔºåËØ∑Á°ÆËÆ§ÊòØÂê¶ÁªßÁª≠Ôºü${NC}"
    read -p "ËæìÂÖ• 'yes' ÁªßÁª≠: " -r
    echo ""
    
    if [ "$REPLY" != "yes" ]; then
        log_info "ÂèñÊ∂àÊÅ¢Â§ç"
        exit 0
    fi
    
    # Â∞ùËØïÈÄöËøá API ÊÅ¢Â§ç
    if curl -s -X POST "${BACKUP_URL}/restore/${backup_id}" > /dev/null 2>&1; then
        log_success "Â§á‰ªΩÊÅ¢Â§çÊàêÂäü"
    else
        log_error "Â§á‰ªΩÊÅ¢Â§çÂ§±Ë¥•"
    fi
}

# ‰∏ªÂáΩÊï∞
main() {
    # ÈªòËÆ§Êìç‰Ωú
    local action="help"
    
    # Ëß£ÊûêÂèÇÊï∞
    while [[ $# -gt 0 ]]; do
        case $1 in
            -h|--help)
                action="help"
                shift
                ;;
            -d|--dev)
                action="dev"
                shift
                ;;
            -p|--preview)
                action="preview"
                shift
                ;;
            -P|--production)
                action="production"
                shift
                ;;
            -t|--test)
                action="test"
                shift
                ;;
            -b|--backup)
                action="backup"
                shift
                ;;
            -c|--clean)
                action="clean"
                shift
                ;;
            -l|--logs)
                action="logs"
                shift
                ;;
            -s|--status)
                action="status"
                shift
                ;;
            -r|--restore)
                action="restore"
                BACKUP_ID="$2"
                shift 2
                ;;
            *)
                log_error "Êú™Áü•ÂèÇÊï∞: $1"
                show_help
                exit 1
                ;;
        esac
    done
    
    # ÊâßË°åÂØπÂ∫îÊìç‰Ωú
    case $action in
        help)
            show_help
            ;;
        dev)
            check_environment
            install_dependencies
            deploy_dev
            ;;
        preview)
            check_environment
            install_dependencies
            deploy_preview
            ;;
        production)
            check_environment
            install_dependencies
            deploy_production
            ;;
        test)
            check_environment
            install_dependencies
            run_tests
            ;;
        backup)
            create_backup
            ;;
        clean)
            clean_build "light"
            ;;
        logs)
            view_logs
            ;;
        status)
            check_status
            ;;
        restore)
            restore_backup "$BACKUP_ID"
            ;;
        *)
            show_help
            ;;
    esac
}

# ËÆæÁΩÆÂ§á‰ªΩ URLÔºà‰ªéÁéØÂ¢ÉÂèòÈáèËé∑ÂèñÊàñ‰ΩøÁî®ÈªòËÆ§ÂÄºÔºâ
BACKUP_URL=${DEPLOY_URL:-"https://dao-hang.yourusername.workers.dev"}/api/backup

# ËøêË°å‰∏ªÂáΩÊï∞
main "$@"
```

Ëøô‰∏™ÂÆåÊï¥ÁöÑÈ°πÁõÆÁªìÊûÑÂåÖÂê´‰∫Ü‰ªéÁâàÊú¨‰∏ÄÂà∞ÁâàÊú¨‰∏âÊâÄÈúÄÁöÑÊâÄÊúâÊñá‰ª∂„ÄÇ‰Ω†ÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®Ëøô‰∏™ÁªìÊûÑÊù•ÂàõÂª∫‰Ω†ÁöÑGitHub‰ªìÂ∫ì„ÄÇ

## ‰ΩøÁî®ËØ¥ÊòéÔºö

1. **ÂàõÂª∫‰ªìÂ∫ì**Ôºö
   ```bash
   git init
   git add .
   git commit -m "ÂàùÂßãÊèê‰∫§"
   git branch -M main
   git remote add origin https://github.com/yourusername/dao-hang.git
   git push -u origin main
   ```

2. **ÈÖçÁΩÆÈ°πÁõÆ**Ôºö
   - Â§çÂà∂ `.env.example` ‰∏∫ `.env`
   - Êõ¥Êñ∞ `wrangler.toml` ‰∏≠ÁöÑÈÖçÁΩÆ
   - ËÆæÁΩÆ Cloudflare KV ÂëΩÂêçÁ©∫Èó¥

3. **ÈÉ®ÁΩ≤**Ôºö
   ```bash
   npm install
   npm run deploy
   ```

4. **ËÆøÈóÆ**Ôºö
   - ‰∏ªÈ°µÔºö`https://‰Ω†ÁöÑÂüüÂêç.workers.dev`
   - ÁÆ°ÁêÜÂêéÂè∞Ôºö`https://‰Ω†ÁöÑÂüüÂêç.workers.dev/admin`

Ëøô‰∏™È°πÁõÆÁªìÊûÑÂÆåÂÖ®Á¨¶Âêà‰Ω†ÁöÑÈúÄÊ±ÇÔºåÂåÖÂê´‰∫ÜÔºö
- ‚úÖ ÁôªÂΩïÁÆ°ÁêÜÂäüËÉΩ
- ‚úÖ Ë¥¶Âè∑ÂØÜÁ†ÅÂèòÈáèÈÖçÁΩÆ
- ‚úÖ Cloudflare KV Â≠òÂÇ®
- ‚úÖ ÂàÜÁ±ªÁÆ°ÁêÜÔºàÂèØÂ±ïÂºÄ/ÈöêËóèÔºâ
- ‚úÖ ËÉåÊôØÂõæÁâáËÆæÁΩÆ
- ‚úÖ ‰∏â‰∏™ÁâàÊú¨ÁöÑËßÑÂàí
- ‚úÖ ÂÆåÊï¥ÁöÑÊñáÊ°£ÂíåËÑöÊú¨

‰Ω†ÂèØ‰ª•Ê†πÊçÆËøô‰∏™ÁªìÊûÑÂºÄÂßãÂºÄÂèë‰Ω†ÁöÑÂØºËà™Á≥ªÁªüÔºÅ